(function(){"use strict";function Vnode(tag,key,attrs0,children0,text,dom){return{tag:tag,key:key,attrs:attrs0,children:children0,text:text,dom:dom,domSize:undefined,state:undefined,events:undefined,instance:undefined}}Vnode.normalize=function(node){if(Array.isArray(node))return Vnode("[",undefined,undefined,Vnode.normalizeChildren(node),undefined,undefined);if(node==null||typeof node==="boolean")return null;if(typeof node==="object")return node;return Vnode("#",undefined,undefined,String(node),undefined,undefined)};Vnode.normalizeChildren=function(input){var children0=[];if(input.length){var isKeyed=input[0]!=null&&input[0].key!=null;for(var i=1;i<input.length;i++){if((input[i]!=null&&input[i].key!=null)!==isKeyed){throw new TypeError("Vnodes must either always have keys or never have keys!")}}for(var i=0;i<input.length;i++){children0[i]=Vnode.normalize(input[i])}}return children0};var hyperscriptVnode=function(){var attrs1=arguments[this],start=this+1,children1;if(attrs1==null){attrs1={}}else if(typeof attrs1!=="object"||attrs1.tag!=null||Array.isArray(attrs1)){attrs1={};start=this}if(arguments.length===start+1){children1=arguments[start];if(!Array.isArray(children1))children1=[children1]}else{children1=[];while(start<arguments.length)children1.push(arguments[start++])}return Vnode("",attrs1.key,attrs1,children1)};var selectorParser=/(?:(^|#|\.)([^#\.\[\]]+))|(\[(.+?)(?:\s*=\s*("|'|)((?:\\["'\]]|.)*?)\5)?\])/g;var selectorCache={};var hasOwn={}.hasOwnProperty;function isEmpty(object){for(var key in object)if(hasOwn.call(object,key))return false;return true}function compileSelector(selector){var match,tag="div",classes=[],attrs={};while(match=selectorParser.exec(selector)){var type=match[1],value=match[2];if(type===""&&value!=="")tag=value;else if(type==="#")attrs.id=value;else if(type===".")classes.push(value);else if(match[3][0]==="["){var attrValue=match[6];if(attrValue)attrValue=attrValue.replace(/\\(["'])/g,"$1").replace(/\\\\/g,"\\");if(match[4]==="class")classes.push(attrValue);else attrs[match[4]]=attrValue===""?attrValue:attrValue||true}}if(classes.length>0)attrs.className=classes.join(" ");return selectorCache[selector]={tag:tag,attrs:attrs}}function execSelector(state,vnode){var attrs=vnode.attrs;var children=Vnode.normalizeChildren(vnode.children);var hasClass=hasOwn.call(attrs,"class");var className=hasClass?attrs.class:attrs.className;vnode.tag=state.tag;vnode.attrs=null;vnode.children=undefined;if(!isEmpty(state.attrs)&&!isEmpty(attrs)){var newAttrs={};for(var key in attrs){if(hasOwn.call(attrs,key))newAttrs[key]=attrs[key]}attrs=newAttrs}for(var key in state.attrs){if(hasOwn.call(state.attrs,key)&&key!=="className"&&!hasOwn.call(attrs,key)){attrs[key]=state.attrs[key]}}if(className!=null||state.attrs.className!=null)attrs.className=className!=null?state.attrs.className!=null?String(state.attrs.className)+" "+String(className):className:state.attrs.className!=null?state.attrs.className:null;if(hasClass)attrs.class=null;for(var key in attrs){if(hasOwn.call(attrs,key)&&key!=="key"){vnode.attrs=attrs;break}}if(Array.isArray(children)&&children.length===1&&children[0]!=null&&children[0].tag==="#"){vnode.text=children[0].children}else{vnode.children=children}return vnode}function hyperscript(selector){if(selector==null||typeof selector!=="string"&&typeof selector!=="function"&&typeof selector.view!=="function"){throw Error("The selector must be either a string or a component.")}var vnode=hyperscriptVnode.apply(1,arguments);if(typeof selector==="string"){vnode.children=Vnode.normalizeChildren(vnode.children);if(selector!=="[")return execSelector(selectorCache[selector]||compileSelector(selector),vnode)}vnode.tag=selector;return vnode}hyperscript.trust=function(html){if(html==null)html="";return Vnode("<",undefined,undefined,html,undefined,undefined)};hyperscript.fragment=function(){var vnode2=hyperscriptVnode.apply(0,arguments);vnode2.tag="[";vnode2.children=Vnode.normalizeChildren(vnode2.children);return vnode2};var PromisePolyfill=function(executor){if(!(this instanceof PromisePolyfill))throw new Error("Promise must be called with `new`");if(typeof executor!=="function")throw new TypeError("executor must be a function");var self=this,resolvers=[],rejectors=[],resolveCurrent=handler(resolvers,true),rejectCurrent=handler(rejectors,false);var instance=self._instance={resolvers:resolvers,rejectors:rejectors};var callAsync=typeof setImmediate==="function"?setImmediate:setTimeout;function handler(list,shouldAbsorb){return function execute(value){var then;try{if(shouldAbsorb&&value!=null&&(typeof value==="object"||typeof value==="function")&&typeof(then=value.then)==="function"){if(value===self)throw new TypeError("Promise can't be resolved w/ itself");executeOnce(then.bind(value))}else{callAsync(function(){if(!shouldAbsorb&&list.length===0)console.error("Possible unhandled promise rejection:",value);for(var i=0;i<list.length;i++)list[i](value);resolvers.length=0,rejectors.length=0;instance.state=shouldAbsorb;instance.retry=function(){execute(value)}})}}catch(e){rejectCurrent(e)}}}function executeOnce(then){var runs=0;function run(fn){return function(value){if(runs++>0)return;fn(value)}}var onerror=run(rejectCurrent);try{then(run(resolveCurrent),onerror)}catch(e){onerror(e)}}executeOnce(executor)};PromisePolyfill.prototype.then=function(onFulfilled,onRejection){var self=this,instance=self._instance;function handle(callback,list,next,state){list.push(function(value){if(typeof callback!=="function")next(value);else try{resolveNext(callback(value))}catch(e){if(rejectNext)rejectNext(e)}});if(typeof instance.retry==="function"&&state===instance.state)instance.retry()}var resolveNext,rejectNext;var promise=new PromisePolyfill(function(resolve,reject){resolveNext=resolve,rejectNext=reject});handle(onFulfilled,instance.resolvers,resolveNext,true),handle(onRejection,instance.rejectors,rejectNext,false);return promise};PromisePolyfill.prototype.catch=function(onRejection){return this.then(null,onRejection)};PromisePolyfill.prototype.finally=function(callback){return this.then(function(value){return PromisePolyfill.resolve(callback()).then(function(){return value})},function(reason){return PromisePolyfill.resolve(callback()).then(function(){return PromisePolyfill.reject(reason)})})};PromisePolyfill.resolve=function(value){if(value instanceof PromisePolyfill)return value;return new PromisePolyfill(function(resolve){resolve(value)})};PromisePolyfill.reject=function(value){return new PromisePolyfill(function(resolve,reject){reject(value)})};PromisePolyfill.all=function(list){return new PromisePolyfill(function(resolve,reject){var total=list.length,count=0,values=[];if(list.length===0)resolve([]);else for(var i=0;i<list.length;i++){(function(i){function consume(value){count++;values[i]=value;if(count===total)resolve(values)}if(list[i]!=null&&(typeof list[i]==="object"||typeof list[i]==="function")&&typeof list[i].then==="function"){list[i].then(consume,reject)}else consume(list[i])})(i)}})};PromisePolyfill.race=function(list){return new PromisePolyfill(function(resolve,reject){for(var i=0;i<list.length;i++){list[i].then(resolve,reject)}})};if(typeof window!=="undefined"){if(typeof window.Promise==="undefined"){window.Promise=PromisePolyfill}else if(!window.Promise.prototype.finally){window.Promise.prototype.finally=PromisePolyfill.prototype.finally}var PromisePolyfill=window.Promise}else if(typeof global!=="undefined"){if(typeof global.Promise==="undefined"){global.Promise=PromisePolyfill}else if(!global.Promise.prototype.finally){global.Promise.prototype.finally=PromisePolyfill.prototype.finally}var PromisePolyfill=global.Promise}else{}var _12=function($window){var $doc=$window&&$window.document;var currentRedraw;var nameSpace={svg:"http://www.w3.org/2000/svg",math:"http://www.w3.org/1998/Math/MathML"};function getNameSpace(vnode3){return vnode3.attrs&&vnode3.attrs.xmlns||nameSpace[vnode3.tag]}function checkState(vnode3,original){if(vnode3.state!==original)throw new Error("`vnode.state` must not be modified")}function callHook(vnode3){var original=vnode3.state;try{return this.apply(original,arguments)}finally{checkState(vnode3,original)}}function activeElement(){try{return $doc.activeElement}catch(e){return null}}function createNodes(parent,vnodes,start,end,hooks,nextSibling,ns){for(var i=start;i<end;i++){var vnode3=vnodes[i];if(vnode3!=null){createNode(parent,vnode3,hooks,ns,nextSibling)}}}function createNode(parent,vnode3,hooks,ns,nextSibling){var tag=vnode3.tag;if(typeof tag==="string"){vnode3.state={};if(vnode3.attrs!=null)initLifecycle(vnode3.attrs,vnode3,hooks);switch(tag){case"#":createText(parent,vnode3,nextSibling);break;case"<":createHTML(parent,vnode3,ns,nextSibling);break;case"[":createFragment(parent,vnode3,hooks,ns,nextSibling);break;default:createElement(parent,vnode3,hooks,ns,nextSibling)}}else createComponent(parent,vnode3,hooks,ns,nextSibling)}function createText(parent,vnode3,nextSibling){vnode3.dom=$doc.createTextNode(vnode3.children);insertNode(parent,vnode3.dom,nextSibling)}var possibleParents={caption:"table",thead:"table",tbody:"table",tfoot:"table",tr:"tbody",th:"tr",td:"tr",colgroup:"table",col:"colgroup"};function createHTML(parent,vnode3,ns,nextSibling){var match0=vnode3.children.match(/^\s*?<(\w+)/im)||[];var temp=$doc.createElement(possibleParents[match0[1]]||"div");if(ns==="http://www.w3.org/2000/svg"){temp.innerHTML='<svg xmlns="http://www.w3.org/2000/svg">'+vnode3.children+"</svg>";temp=temp.firstChild}else{temp.innerHTML=vnode3.children}vnode3.dom=temp.firstChild;vnode3.domSize=temp.childNodes.length;vnode3.instance=[];var fragment=$doc.createDocumentFragment();var child;while(child=temp.firstChild){vnode3.instance.push(child);fragment.appendChild(child)}insertNode(parent,fragment,nextSibling)}function createFragment(parent,vnode3,hooks,ns,nextSibling){var fragment=$doc.createDocumentFragment();if(vnode3.children!=null){var children3=vnode3.children;createNodes(fragment,children3,0,children3.length,hooks,null,ns)}vnode3.dom=fragment.firstChild;vnode3.domSize=fragment.childNodes.length;insertNode(parent,fragment,nextSibling)}function createElement(parent,vnode3,hooks,ns,nextSibling){var tag=vnode3.tag;var attrs2=vnode3.attrs;var is=attrs2&&attrs2.is;ns=getNameSpace(vnode3)||ns;var element=ns?is?$doc.createElementNS(ns,tag,{is:is}):$doc.createElementNS(ns,tag):is?$doc.createElement(tag,{is:is}):$doc.createElement(tag);vnode3.dom=element;if(attrs2!=null){setAttrs(vnode3,attrs2,ns)}insertNode(parent,element,nextSibling);if(!maybeSetContentEditable(vnode3)){if(vnode3.text!=null){if(vnode3.text!=="")element.textContent=vnode3.text;else vnode3.children=[Vnode("#",undefined,undefined,vnode3.text,undefined,undefined)]}if(vnode3.children!=null){var children3=vnode3.children;createNodes(element,children3,0,children3.length,hooks,null,ns);if(vnode3.tag==="select"&&attrs2!=null)setLateSelectAttrs(vnode3,attrs2)}}}function initComponent(vnode3,hooks){var sentinel;if(typeof vnode3.tag.view==="function"){vnode3.state=Object.create(vnode3.tag);sentinel=vnode3.state.view;if(sentinel.$$reentrantLock$$!=null)return;sentinel.$$reentrantLock$$=true}else{vnode3.state=void 0;sentinel=vnode3.tag;if(sentinel.$$reentrantLock$$!=null)return;sentinel.$$reentrantLock$$=true;vnode3.state=vnode3.tag.prototype!=null&&typeof vnode3.tag.prototype.view==="function"?new vnode3.tag(vnode3):vnode3.tag(vnode3)}initLifecycle(vnode3.state,vnode3,hooks);if(vnode3.attrs!=null)initLifecycle(vnode3.attrs,vnode3,hooks);vnode3.instance=Vnode.normalize(callHook.call(vnode3.state.view,vnode3));if(vnode3.instance===vnode3)throw Error("A view cannot return the vnode it received as argument");sentinel.$$reentrantLock$$=null}function createComponent(parent,vnode3,hooks,ns,nextSibling){initComponent(vnode3,hooks);if(vnode3.instance!=null){createNode(parent,vnode3.instance,hooks,ns,nextSibling);vnode3.dom=vnode3.instance.dom;vnode3.domSize=vnode3.dom!=null?vnode3.instance.domSize:0}else{vnode3.domSize=0}}function updateNodes(parent,old,vnodes,hooks,nextSibling,ns){if(old===vnodes||old==null&&vnodes==null)return;else if(old==null||old.length===0)createNodes(parent,vnodes,0,vnodes.length,hooks,nextSibling,ns);else if(vnodes==null||vnodes.length===0)removeNodes(parent,old,0,old.length);else{var isOldKeyed=old[0]!=null&&old[0].key!=null;var isKeyed0=vnodes[0]!=null&&vnodes[0].key!=null;var start=0,oldStart=0;if(!isOldKeyed)while(oldStart<old.length&&old[oldStart]==null)oldStart++;if(!isKeyed0)while(start<vnodes.length&&vnodes[start]==null)start++;if(isKeyed0===null&&isOldKeyed==null)return;if(isOldKeyed!==isKeyed0){removeNodes(parent,old,oldStart,old.length);createNodes(parent,vnodes,start,vnodes.length,hooks,nextSibling,ns)}else if(!isKeyed0){var commonLength=old.length<vnodes.length?old.length:vnodes.length;start=start<oldStart?start:oldStart;for(;start<commonLength;start++){o=old[start];v=vnodes[start];if(o===v||o==null&&v==null)continue;else if(o==null)createNode(parent,v,hooks,ns,getNextSibling(old,start+1,nextSibling));else if(v==null)removeNode(parent,o);else updateNode(parent,o,v,hooks,getNextSibling(old,start+1,nextSibling),ns)}if(old.length>commonLength)removeNodes(parent,old,start,old.length);if(vnodes.length>commonLength)createNodes(parent,vnodes,start,vnodes.length,hooks,nextSibling,ns)}else{var oldEnd=old.length-1,end=vnodes.length-1,map,o,v,oe,ve,topSibling;while(oldEnd>=oldStart&&end>=start){oe=old[oldEnd];ve=vnodes[end];if(oe.key!==ve.key)break;if(oe!==ve)updateNode(parent,oe,ve,hooks,nextSibling,ns);if(ve.dom!=null)nextSibling=ve.dom;oldEnd--,end--}while(oldEnd>=oldStart&&end>=start){o=old[oldStart];v=vnodes[start];if(o.key!==v.key)break;oldStart++,start++;if(o!==v)updateNode(parent,o,v,hooks,getNextSibling(old,oldStart,nextSibling),ns)}while(oldEnd>=oldStart&&end>=start){if(start===end)break;if(o.key!==ve.key||oe.key!==v.key)break;topSibling=getNextSibling(old,oldStart,nextSibling);moveNodes(parent,oe,topSibling);if(oe!==v)updateNode(parent,oe,v,hooks,topSibling,ns);if(++start<=--end)moveNodes(parent,o,nextSibling);if(o!==ve)updateNode(parent,o,ve,hooks,nextSibling,ns);if(ve.dom!=null)nextSibling=ve.dom;oldStart++;oldEnd--;oe=old[oldEnd];ve=vnodes[end];o=old[oldStart];v=vnodes[start]}while(oldEnd>=oldStart&&end>=start){if(oe.key!==ve.key)break;if(oe!==ve)updateNode(parent,oe,ve,hooks,nextSibling,ns);if(ve.dom!=null)nextSibling=ve.dom;oldEnd--,end--;oe=old[oldEnd];ve=vnodes[end]}if(start>end)removeNodes(parent,old,oldStart,oldEnd+1);else if(oldStart>oldEnd)createNodes(parent,vnodes,start,end+1,hooks,nextSibling,ns);else{var originalNextSibling=nextSibling,vnodesLength=end-start+1,oldIndices=new Array(vnodesLength),li=0,i=0,pos=2147483647,matched=0,map,lisIndices;for(i=0;i<vnodesLength;i++)oldIndices[i]=-1;for(i=end;i>=start;i--){if(map==null)map=getKeyMap(old,oldStart,oldEnd+1);ve=vnodes[i];var oldIndex=map[ve.key];if(oldIndex!=null){pos=oldIndex<pos?oldIndex:-1;oldIndices[i-start]=oldIndex;oe=old[oldIndex];old[oldIndex]=null;if(oe!==ve)updateNode(parent,oe,ve,hooks,nextSibling,ns);if(ve.dom!=null)nextSibling=ve.dom;matched++}}nextSibling=originalNextSibling;if(matched!==oldEnd-oldStart+1)removeNodes(parent,old,oldStart,oldEnd+1);if(matched===0)createNodes(parent,vnodes,start,end+1,hooks,nextSibling,ns);else{if(pos===-1){lisIndices=makeLisIndices(oldIndices);li=lisIndices.length-1;for(i=end;i>=start;i--){v=vnodes[i];if(oldIndices[i-start]===-1)createNode(parent,v,hooks,ns,nextSibling);else{if(lisIndices[li]===i-start)li--;else moveNodes(parent,v,nextSibling)}if(v.dom!=null)nextSibling=vnodes[i].dom}}else{for(i=end;i>=start;i--){v=vnodes[i];if(oldIndices[i-start]===-1)createNode(parent,v,hooks,ns,nextSibling);if(v.dom!=null)nextSibling=vnodes[i].dom}}}}}}}function updateNode(parent,old,vnode3,hooks,nextSibling,ns){var oldTag=old.tag,tag=vnode3.tag;if(oldTag===tag){vnode3.state=old.state;vnode3.events=old.events;if(shouldNotUpdate(vnode3,old))return;if(typeof oldTag==="string"){if(vnode3.attrs!=null){updateLifecycle(vnode3.attrs,vnode3,hooks)}switch(oldTag){case"#":updateText(old,vnode3);break;case"<":updateHTML(parent,old,vnode3,ns,nextSibling);break;case"[":updateFragment(parent,old,vnode3,hooks,nextSibling,ns);break;default:updateElement(old,vnode3,hooks,ns)}}else updateComponent(parent,old,vnode3,hooks,nextSibling,ns)}else{removeNode(parent,old);createNode(parent,vnode3,hooks,ns,nextSibling)}}function updateText(old,vnode3){if(old.children.toString()!==vnode3.children.toString()){old.dom.nodeValue=vnode3.children}vnode3.dom=old.dom}function updateHTML(parent,old,vnode3,ns,nextSibling){if(old.children!==vnode3.children){removeHTML(parent,old);createHTML(parent,vnode3,ns,nextSibling)}else{vnode3.dom=old.dom;vnode3.domSize=old.domSize;vnode3.instance=old.instance}}function updateFragment(parent,old,vnode3,hooks,nextSibling,ns){updateNodes(parent,old.children,vnode3.children,hooks,nextSibling,ns);var domSize=0,children3=vnode3.children;vnode3.dom=null;if(children3!=null){for(var i=0;i<children3.length;i++){var child=children3[i];if(child!=null&&child.dom!=null){if(vnode3.dom==null)vnode3.dom=child.dom;domSize+=child.domSize||1}}if(domSize!==1)vnode3.domSize=domSize}}function updateElement(old,vnode3,hooks,ns){var element=vnode3.dom=old.dom;ns=getNameSpace(vnode3)||ns;if(vnode3.tag==="textarea"){if(vnode3.attrs==null)vnode3.attrs={};if(vnode3.text!=null){vnode3.attrs.value=vnode3.text;vnode3.text=undefined}}updateAttrs(vnode3,old.attrs,vnode3.attrs,ns);if(!maybeSetContentEditable(vnode3)){if(old.text!=null&&vnode3.text!=null&&vnode3.text!==""){if(old.text.toString()!==vnode3.text.toString())old.dom.firstChild.nodeValue=vnode3.text}else{if(old.text!=null)old.children=[Vnode("#",undefined,undefined,old.text,undefined,old.dom.firstChild)];if(vnode3.text!=null)vnode3.children=[Vnode("#",undefined,undefined,vnode3.text,undefined,undefined)];updateNodes(element,old.children,vnode3.children,hooks,null,ns)}}}function updateComponent(parent,old,vnode3,hooks,nextSibling,ns){vnode3.instance=Vnode.normalize(callHook.call(vnode3.state.view,vnode3));if(vnode3.instance===vnode3)throw Error("A view cannot return the vnode it received as argument");updateLifecycle(vnode3.state,vnode3,hooks);if(vnode3.attrs!=null)updateLifecycle(vnode3.attrs,vnode3,hooks);if(vnode3.instance!=null){if(old.instance==null)createNode(parent,vnode3.instance,hooks,ns,nextSibling);else updateNode(parent,old.instance,vnode3.instance,hooks,nextSibling,ns);vnode3.dom=vnode3.instance.dom;vnode3.domSize=vnode3.instance.domSize}else if(old.instance!=null){removeNode(parent,old.instance);vnode3.dom=undefined;vnode3.domSize=0}else{vnode3.dom=old.dom;vnode3.domSize=old.domSize}}function getKeyMap(vnodes,start,end){var map=Object.create(null);for(;start<end;start++){var vnode3=vnodes[start];if(vnode3!=null){var key=vnode3.key;if(key!=null)map[key]=start}}return map}var lisTemp=[];function makeLisIndices(a){var result=[0];var u=0,v=0,i=0;var il=lisTemp.length=a.length;for(var i=0;i<il;i++)lisTemp[i]=a[i];for(var i=0;i<il;++i){if(a[i]===-1)continue;var j=result[result.length-1];if(a[j]<a[i]){lisTemp[i]=j;result.push(i);continue}u=0;v=result.length-1;while(u<v){var c=(u>>>1)+(v>>>1)+(u&v&1);if(a[result[c]]<a[i]){u=c+1}else{v=c}}if(a[i]<a[result[u]]){if(u>0)lisTemp[i]=result[u-1];result[u]=i}}u=result.length;v=result[u-1];while(u-- >0){result[u]=v;v=lisTemp[v]}lisTemp.length=0;return result}function getNextSibling(vnodes,i,nextSibling){for(;i<vnodes.length;i++){if(vnodes[i]!=null&&vnodes[i].dom!=null)return vnodes[i].dom}return nextSibling}function moveNodes(parent,vnode3,nextSibling){var frag=$doc.createDocumentFragment();moveChildToFrag(parent,frag,vnode3);insertNode(parent,frag,nextSibling)}function moveChildToFrag(parent,frag,vnode3){while(vnode3.dom!=null&&vnode3.dom.parentNode===parent){if(typeof vnode3.tag!=="string"){vnode3=vnode3.instance;if(vnode3!=null)continue}else if(vnode3.tag==="<"){for(var i=0;i<vnode3.instance.length;i++){frag.appendChild(vnode3.instance[i])}}else if(vnode3.tag!=="["){frag.appendChild(vnode3.dom)}else if(vnode3.children.length===1){vnode3=vnode3.children[0];if(vnode3!=null)continue}else{for(var i=0;i<vnode3.children.length;i++){var child=vnode3.children[i];if(child!=null)moveChildToFrag(parent,frag,child)}}break}}function insertNode(parent,dom,nextSibling){if(nextSibling!=null)parent.insertBefore(dom,nextSibling);else parent.appendChild(dom)}function maybeSetContentEditable(vnode3){if(vnode3.attrs==null||vnode3.attrs.contenteditable==null&&vnode3.attrs.contentEditable==null)return false;var children3=vnode3.children;if(children3!=null&&children3.length===1&&children3[0].tag==="<"){var content=children3[0].children;if(vnode3.dom.innerHTML!==content)vnode3.dom.innerHTML=content}else if(vnode3.text!=null||children3!=null&&children3.length!==0)throw new Error("Child node of a contenteditable must be trusted");return true}function removeNodes(parent,vnodes,start,end){for(var i=start;i<end;i++){var vnode3=vnodes[i];if(vnode3!=null)removeNode(parent,vnode3)}}function removeNode(parent,vnode3){var mask=0;var original=vnode3.state;var stateResult,attrsResult;if(typeof vnode3.tag!=="string"&&typeof vnode3.state.onbeforeremove==="function"){var result=callHook.call(vnode3.state.onbeforeremove,vnode3);if(result!=null&&typeof result.then==="function"){mask=1;stateResult=result}}if(vnode3.attrs&&typeof vnode3.attrs.onbeforeremove==="function"){var result=callHook.call(vnode3.attrs.onbeforeremove,vnode3);if(result!=null&&typeof result.then==="function"){mask|=2;attrsResult=result}}checkState(vnode3,original);if(!mask){onremove(vnode3);removeChild(parent,vnode3)}else{if(stateResult!=null){var next=function(){if(mask&1){mask&=2;if(!mask)reallyRemove()}};stateResult.then(next,next)}if(attrsResult!=null){var next=function(){if(mask&2){mask&=1;if(!mask)reallyRemove()}};attrsResult.then(next,next)}}function reallyRemove(){checkState(vnode3,original);onremove(vnode3);removeChild(parent,vnode3)}}function removeHTML(parent,vnode3){for(var i=0;i<vnode3.instance.length;i++){parent.removeChild(vnode3.instance[i])}}function removeChild(parent,vnode3){while(vnode3.dom!=null&&vnode3.dom.parentNode===parent){if(typeof vnode3.tag!=="string"){vnode3=vnode3.instance;if(vnode3!=null)continue}else if(vnode3.tag==="<"){removeHTML(parent,vnode3)}else{if(vnode3.tag!=="["){parent.removeChild(vnode3.dom);if(!Array.isArray(vnode3.children))break}if(vnode3.children.length===1){vnode3=vnode3.children[0];if(vnode3!=null)continue}else{for(var i=0;i<vnode3.children.length;i++){var child=vnode3.children[i];if(child!=null)removeChild(parent,child)}}}break}}function onremove(vnode3){if(typeof vnode3.tag!=="string"&&typeof vnode3.state.onremove==="function")callHook.call(vnode3.state.onremove,vnode3);if(vnode3.attrs&&typeof vnode3.attrs.onremove==="function")callHook.call(vnode3.attrs.onremove,vnode3);if(typeof vnode3.tag!=="string"){if(vnode3.instance!=null)onremove(vnode3.instance)}else{var children3=vnode3.children;if(Array.isArray(children3)){for(var i=0;i<children3.length;i++){var child=children3[i];if(child!=null)onremove(child)}}}}function setAttrs(vnode3,attrs2,ns){for(var key in attrs2){setAttr(vnode3,key,null,attrs2[key],ns)}}function setAttr(vnode3,key,old,value,ns){if(key==="key"||key==="is"||value==null||isLifecycleMethod(key)||old===value&&!isFormAttribute(vnode3,key)&&typeof value!=="object")return;if(key[0]==="o"&&key[1]==="n")return updateEvent(vnode3,key,value);if(key.slice(0,6)==="xlink:")vnode3.dom.setAttributeNS("http://www.w3.org/1999/xlink",key.slice(6),value);else if(key==="style")updateStyle(vnode3.dom,old,value);else if(hasPropertyKey(vnode3,key,ns)){if(key==="value"){if((vnode3.tag==="input"||vnode3.tag==="textarea")&&vnode3.dom.value===""+value&&vnode3.dom===activeElement())return;if(vnode3.tag==="select"&&old!==null&&vnode3.dom.value===""+value)return;if(vnode3.tag==="option"&&old!==null&&vnode3.dom.value===""+value)return}if(vnode3.tag==="input"&&key==="type")vnode3.dom.setAttribute(key,value);else vnode3.dom[key]=value}else{if(typeof value==="boolean"){if(value)vnode3.dom.setAttribute(key,"");else vnode3.dom.removeAttribute(key)}else vnode3.dom.setAttribute(key==="className"?"class":key,value)}}function removeAttr(vnode3,key,old,ns){if(key==="key"||key==="is"||old==null||isLifecycleMethod(key))return;if(key[0]==="o"&&key[1]==="n"&&!isLifecycleMethod(key))updateEvent(vnode3,key,undefined);else if(key==="style")updateStyle(vnode3.dom,old,null);else if(hasPropertyKey(vnode3,key,ns)&&key!=="className"&&!(key==="value"&&(vnode3.tag==="option"||vnode3.tag==="select"&&vnode3.dom.selectedIndex===-1&&vnode3.dom===activeElement()))&&!(vnode3.tag==="input"&&key==="type")){vnode3.dom[key]=null}else{var nsLastIndex=key.indexOf(":");if(nsLastIndex!==-1)key=key.slice(nsLastIndex+1);if(old!==false)vnode3.dom.removeAttribute(key==="className"?"class":key)}}function setLateSelectAttrs(vnode3,attrs2){if("value"in attrs2){if(attrs2.value===null){if(vnode3.dom.selectedIndex!==-1)vnode3.dom.value=null}else{var normalized=""+attrs2.value;if(vnode3.dom.value!==normalized||vnode3.dom.selectedIndex===-1){vnode3.dom.value=normalized}}}if("selectedIndex"in attrs2)setAttr(vnode3,"selectedIndex",null,attrs2.selectedIndex,undefined)}function updateAttrs(vnode3,old,attrs2,ns){if(attrs2!=null){for(var key in attrs2){setAttr(vnode3,key,old&&old[key],attrs2[key],ns)}}var val;if(old!=null){for(var key in old){if((val=old[key])!=null&&(attrs2==null||attrs2[key]==null)){removeAttr(vnode3,key,val,ns)}}}}function isFormAttribute(vnode3,attr){return attr==="value"||attr==="checked"||attr==="selectedIndex"||attr==="selected"&&vnode3.dom===activeElement()||vnode3.tag==="option"&&vnode3.dom.parentNode===$doc.activeElement}function isLifecycleMethod(attr){return attr==="oninit"||attr==="oncreate"||attr==="onupdate"||attr==="onremove"||attr==="onbeforeremove"||attr==="onbeforeupdate"}function hasPropertyKey(vnode3,key,ns){return ns===undefined&&(vnode3.tag.indexOf("-")>-1||vnode3.attrs!=null&&vnode3.attrs.is||key!=="href"&&key!=="list"&&key!=="form"&&key!=="width"&&key!=="height")&&key in vnode3.dom}var uppercaseRegex=/[A-Z]/g;function toLowerCase(capital){return"-"+capital.toLowerCase()}function normalizeKey(key){return key[0]==="-"&&key[1]==="-"?key:key==="cssFloat"?"float":key.replace(uppercaseRegex,toLowerCase)}function updateStyle(element,old,style){if(old===style){}else if(style==null){element.style.cssText=""}else if(typeof style!=="object"){element.style.cssText=style}else if(old==null||typeof old!=="object"){element.style.cssText="";for(var key in style){var value=style[key];if(value!=null)element.style.setProperty(normalizeKey(key),String(value))}}else{for(var key in style){var value=style[key];if(value!=null&&(value=String(value))!==String(old[key])){element.style.setProperty(normalizeKey(key),value)}}for(var key in old){if(old[key]!=null&&style[key]==null){element.style.removeProperty(normalizeKey(key))}}}}function EventDict(){this._=currentRedraw}EventDict.prototype=Object.create(null);EventDict.prototype.handleEvent=function(ev){var handler0=this["on"+ev.type];var result;if(typeof handler0==="function")result=handler0.call(ev.currentTarget,ev);else if(typeof handler0.handleEvent==="function")handler0.handleEvent(ev);if(this._&&ev.redraw!==false)(0,this._)();if(result===false){ev.preventDefault();ev.stopPropagation()}};function updateEvent(vnode3,key,value){if(vnode3.events!=null){if(vnode3.events[key]===value)return;if(value!=null&&(typeof value==="function"||typeof value==="object")){if(vnode3.events[key]==null)vnode3.dom.addEventListener(key.slice(2),vnode3.events,false);vnode3.events[key]=value}else{if(vnode3.events[key]!=null)vnode3.dom.removeEventListener(key.slice(2),vnode3.events,false);vnode3.events[key]=undefined}}else if(value!=null&&(typeof value==="function"||typeof value==="object")){vnode3.events=new EventDict;vnode3.dom.addEventListener(key.slice(2),vnode3.events,false);vnode3.events[key]=value}}function initLifecycle(source,vnode3,hooks){if(typeof source.oninit==="function")callHook.call(source.oninit,vnode3);if(typeof source.oncreate==="function")hooks.push(callHook.bind(source.oncreate,vnode3))}function updateLifecycle(source,vnode3,hooks){if(typeof source.onupdate==="function")hooks.push(callHook.bind(source.onupdate,vnode3))}function shouldNotUpdate(vnode3,old){do{if(vnode3.attrs!=null&&typeof vnode3.attrs.onbeforeupdate==="function"){var force=callHook.call(vnode3.attrs.onbeforeupdate,vnode3,old);if(force!==undefined&&!force)break}if(typeof vnode3.tag!=="string"&&typeof vnode3.state.onbeforeupdate==="function"){var force=callHook.call(vnode3.state.onbeforeupdate,vnode3,old);if(force!==undefined&&!force)break}return false}while(false);vnode3.dom=old.dom;vnode3.domSize=old.domSize;vnode3.instance=old.instance;vnode3.attrs=old.attrs;vnode3.children=old.children;vnode3.text=old.text;return true}return function(dom,vnodes,redraw){if(!dom)throw new TypeError("Ensure the DOM element being passed to m.route/m.mount/m.render is not undefined.");var hooks=[];var active=activeElement();var namespace=dom.namespaceURI;if(dom.vnodes==null)dom.textContent="";vnodes=Vnode.normalizeChildren(Array.isArray(vnodes)?vnodes:[vnodes]);var prevRedraw=currentRedraw;try{currentRedraw=typeof redraw==="function"?redraw:undefined;updateNodes(dom,dom.vnodes,vnodes,hooks,null,namespace==="http://www.w3.org/1999/xhtml"?undefined:namespace)}finally{currentRedraw=prevRedraw}dom.vnodes=vnodes;if(active!=null&&activeElement()!==active&&typeof active.focus==="function")active.focus();for(var i=0;i<hooks.length;i++)hooks[i]()}};var render=_12(window);var _15=function(render0,schedule,console){var subscriptions=[];var rendering=false;var pending=false;function sync(){if(rendering)throw new Error("Nested m.redraw.sync() call");rendering=true;for(var i=0;i<subscriptions.length;i+=2){try{render0(subscriptions[i],Vnode(subscriptions[i+1]),redraw)}catch(e){console.error(e)}}rendering=false}function redraw(){if(!pending){pending=true;schedule(function(){pending=false;sync()})}}redraw.sync=sync;function mount(root,component){if(component!=null&&component.view==null&&typeof component!=="function"){throw new TypeError("m.mount(element, component) expects a component, not a vnode")}var index=subscriptions.indexOf(root);if(index>=0){subscriptions.splice(index,2);render0(root,[],redraw)}if(component!=null){subscriptions.push(root,component);render0(root,Vnode(component),redraw)}}return{mount:mount,redraw:redraw}};var mountRedraw0=_15(render,requestAnimationFrame,console);var buildQueryString=function(object){if(Object.prototype.toString.call(object)!=="[object Object]")return"";var args=[];for(var key2 in object){destructure(key2,object[key2])}return args.join("&");function destructure(key2,value1){if(Array.isArray(value1)){for(var i=0;i<value1.length;i++){destructure(key2+"["+i+"]",value1[i])}}else if(Object.prototype.toString.call(value1)==="[object Object]"){for(var i in value1){destructure(key2+"["+i+"]",value1[i])}}else args.push(encodeURIComponent(key2)+(value1!=null&&value1!==""?"="+encodeURIComponent(value1):""))}};var assign=Object.assign||function(target,source){if(source)Object.keys(source).forEach(function(key3){target[key3]=source[key3]})};var buildPathname=function(template,params){if(/:([^\/\.-]+)(\.{3})?:/.test(template)){throw new SyntaxError("Template parameter names *must* be separated")}if(params==null)return template;var queryIndex=template.indexOf("?");var hashIndex=template.indexOf("#");var queryEnd=hashIndex<0?template.length:hashIndex;var pathEnd=queryIndex<0?queryEnd:queryIndex;var path=template.slice(0,pathEnd);var query={};assign(query,params);var resolved=path.replace(/:([^\/\.-]+)(\.{3})?/g,function(m2,key1,variadic){delete query[key1];if(params[key1]==null)return m2;return variadic?params[key1]:encodeURIComponent(String(params[key1]))});var newQueryIndex=resolved.indexOf("?");var newHashIndex=resolved.indexOf("#");var newQueryEnd=newHashIndex<0?resolved.length:newHashIndex;var newPathEnd=newQueryIndex<0?newQueryEnd:newQueryIndex;var result0=resolved.slice(0,newPathEnd);if(queryIndex>=0)result0+=template.slice(queryIndex,queryEnd);if(newQueryIndex>=0)result0+=(queryIndex<0?"?":"&")+resolved.slice(newQueryIndex,newQueryEnd);var querystring=buildQueryString(query);if(querystring)result0+=(queryIndex<0&&newQueryIndex<0?"?":"&")+querystring;if(hashIndex>=0)result0+=template.slice(hashIndex);if(newHashIndex>=0)result0+=(hashIndex<0?"":"&")+resolved.slice(newHashIndex);return result0};var _18=function($window,Promise,oncompletion){var callbackCount=0;function PromiseProxy(executor){return new Promise(executor)}PromiseProxy.prototype=Promise.prototype;PromiseProxy.__proto__=Promise;function makeRequest(factory){return function(url,args){if(typeof url!=="string"){args=url;url=url.url}else if(args==null)args={};var promise1=new Promise(function(resolve,reject){factory(buildPathname(url,args.params),args,function(data){if(typeof args.type==="function"){if(Array.isArray(data)){for(var i=0;i<data.length;i++){data[i]=new args.type(data[i])}}else data=new args.type(data)}resolve(data)},reject)});if(args.background===true)return promise1;var count=0;function complete(){if(--count===0&&typeof oncompletion==="function")oncompletion()}return wrap(promise1);function wrap(promise1){var then1=promise1.then;promise1.constructor=PromiseProxy;promise1.then=function(){count++;var next0=then1.apply(promise1,arguments);next0.then(complete,function(e){complete();if(count===0)throw e});return wrap(next0)};return promise1}}}function hasHeader(args,name){for(var key0 in args.headers){if({}.hasOwnProperty.call(args.headers,key0)&&name.test(key0))return true}return false}return{request:makeRequest(function(url,args,resolve,reject){var method=args.method!=null?args.method.toUpperCase():"GET";var body=args.body;var assumeJSON=(args.serialize==null||args.serialize===JSON.serialize)&&!(body instanceof $window.FormData);var responseType=args.responseType||(typeof args.extract==="function"?"":"json");var xhr=new $window.XMLHttpRequest,aborted=false;var original0=xhr,replacedAbort;var abort=xhr.abort;xhr.abort=function(){aborted=true;abort.call(this)};xhr.open(method,url,args.async!==false,typeof args.user==="string"?args.user:undefined,typeof args.password==="string"?args.password:undefined);if(assumeJSON&&body!=null&&!hasHeader(args,/^content0-type1$/i)){xhr.setRequestHeader("Content-Type","application/json; charset=utf-8")}if(typeof args.deserialize!=="function"&&!hasHeader(args,/^accept$/i)){xhr.setRequestHeader("Accept","application/json, text/*")}if(args.withCredentials)xhr.withCredentials=args.withCredentials;if(args.timeout)xhr.timeout=args.timeout;xhr.responseType=responseType;for(var key0 in args.headers){if({}.hasOwnProperty.call(args.headers,key0)){xhr.setRequestHeader(key0,args.headers[key0])}}xhr.onreadystatechange=function(ev){if(aborted)return;if(ev.target.readyState===4){try{var success=ev.target.status>=200&&ev.target.status<300||ev.target.status===304||/^file:\/\//i.test(url);var response=ev.target.response,message;if(responseType==="json"){if(!ev.target.responseType&&typeof args.extract!=="function")response=JSON.parse(ev.target.responseText)}else if(!responseType||responseType==="text"){if(response==null)response=ev.target.responseText}if(typeof args.extract==="function"){response=args.extract(ev.target,args);success=true}else if(typeof args.deserialize==="function"){response=args.deserialize(response)}if(success)resolve(response);else{try{message=ev.target.responseText}catch(e){message=response}var error=new Error(message);error.code=ev.target.status;error.response=response;reject(error)}}catch(e){reject(e)}}};if(typeof args.config==="function"){xhr=args.config(xhr,args,url)||xhr;if(xhr!==original0){replacedAbort=xhr.abort;xhr.abort=function(){aborted=true;replacedAbort.call(this)}}}if(body==null)xhr.send();else if(typeof args.serialize==="function")xhr.send(args.serialize(body));else if(body instanceof $window.FormData)xhr.send(body);else xhr.send(JSON.stringify(body))}),jsonp:makeRequest(function(url,args,resolve,reject){var callbackName=args.callbackName||"_mithril_"+Math.round(Math.random()*1e16)+"_"+callbackCount++;var script=$window.document.createElement("script");$window[callbackName]=function(data){delete $window[callbackName];script.parentNode.removeChild(script);resolve(data)};script.onerror=function(){delete $window[callbackName];script.parentNode.removeChild(script);reject(new Error("JSONP request failed"))};script.src=url+(url.indexOf("?")<0?"?":"&")+encodeURIComponent(args.callbackKey||"callback")+"="+encodeURIComponent(callbackName);$window.document.documentElement.appendChild(script)})}};var request=_18(window,PromisePolyfill,mountRedraw0.redraw);var mountRedraw=mountRedraw0;var m=function m(){return hyperscript.apply(this,arguments)};m.m=hyperscript;m.trust=hyperscript.trust;m.fragment=hyperscript.fragment;m.mount=mountRedraw.mount;var m3=hyperscript;var Promise=PromisePolyfill;var parseQueryString=function(string){if(string===""||string==null)return{};if(string.charAt(0)==="?")string=string.slice(1);var entries=string.split("&"),counters={},data0={};for(var i=0;i<entries.length;i++){var entry=entries[i].split("=");var key5=decodeURIComponent(entry[0]);var value2=entry.length===2?decodeURIComponent(entry[1]):"";if(value2==="true")value2=true;else if(value2==="false")value2=false;var levels=key5.split(/\]\[?|\[/);var cursor=data0;if(key5.indexOf("[")>-1)levels.pop();for(var j0=0;j0<levels.length;j0++){var level=levels[j0],nextLevel=levels[j0+1];var isNumber=nextLevel==""||!isNaN(parseInt(nextLevel,10));if(level===""){var key5=levels.slice(0,j0).join();if(counters[key5]==null){counters[key5]=Array.isArray(cursor)?cursor.length:0}level=counters[key5]++}else if(level==="__proto__")break;if(j0===levels.length-1)cursor[level]=value2;else{var desc=Object.getOwnPropertyDescriptor(cursor,level);if(desc!=null)desc=desc.value;if(desc==null)cursor[level]=desc=isNumber?[]:{};cursor=desc}}}return data0};var parsePathname=function(url){var queryIndex0=url.indexOf("?");var hashIndex0=url.indexOf("#");var queryEnd0=hashIndex0<0?url.length:hashIndex0;var pathEnd0=queryIndex0<0?queryEnd0:queryIndex0;var path1=url.slice(0,pathEnd0).replace(/\/{2,}/g,"/");if(!path1)path1="/";else{if(path1[0]!=="/")path1="/"+path1;if(path1.length>1&&path1[path1.length-1]==="/")path1=path1.slice(0,-1)}return{path:path1,params:queryIndex0<0?{}:parseQueryString(url.slice(queryIndex0+1,queryEnd0))}};var compileTemplate=function(template){var templateData=parsePathname(template);var templateKeys=Object.keys(templateData.params);var keys=[];var regexp=new RegExp("^"+templateData.path.replace(/:([^\/.-]+)(\.{3}|\.(?!\.)|-)?|[\\^$*+.()|\[\]{}]/g,function(m4,key6,extra){if(key6==null)return"\\"+m4;keys.push({k:key6,r:extra==="..."});if(extra==="...")return"(.*)";if(extra===".")return"([^/]+)\\.";return"([^/]+)"+(extra||"")})+"$");return function(data1){for(var i=0;i<templateKeys.length;i++){if(templateData.params[templateKeys[i]]!==data1.params[templateKeys[i]])return false}if(!keys.length)return regexp.test(data1.path);var values=regexp.exec(data1.path);if(values==null)return false;for(var i=0;i<keys.length;i++){data1.params[keys[i].k]=keys[i].r?values[i+1]:decodeURIComponent(values[i+1])}return true}};var sentinel0={};var _25=function($window,mountRedraw00){var fireAsync;function setPath(path0,data,options){path0=buildPathname(path0,data);if(fireAsync!=null){fireAsync();var state=options?options.state:null;var title=options?options.title:null;if(options&&options.replace)$window.history.replaceState(state,title,route.prefix+path0);else $window.history.pushState(state,title,route.prefix+path0)}else{$window.location.href=route.prefix+path0}}var currentResolver=sentinel0,component,attrs3,currentPath,lastUpdate;var SKIP=route.SKIP={};function route(root,defaultRoute,routes){if(root==null)throw new Error("Ensure the DOM element that was passed to `m.route` is not undefined");var state=0;var compiled=Object.keys(routes).map(function(route){if(route[0]!=="/")throw new SyntaxError("Routes must start with a `/`");if(/:([^\/\.-]+)(\.{3})?:/.test(route)){throw new SyntaxError("Route parameter names must be separated with either `/`, `.`, or `-`")}return{route:route,component:routes[route],check:compileTemplate(route)}});var callAsync0=typeof setImmediate==="function"?setImmediate:setTimeout;var p=Promise.resolve();var scheduled=false;var onremove0;fireAsync=null;if(defaultRoute!=null){var defaultData=parsePathname(defaultRoute);if(!compiled.some(function(i){return i.check(defaultData)})){throw new ReferenceError("Default route doesn't match any known routes")}}function resolveRoute(){scheduled=false;var prefix=$window.location.hash;if(route.prefix[0]!=="#"){prefix=$window.location.search+prefix;if(route.prefix[0]!=="?"){prefix=$window.location.pathname+prefix;if(prefix[0]!=="/")prefix="/"+prefix}}var path0=prefix.concat().replace(/(?:%[a-f89][a-f0-9])+/gim,decodeURIComponent).slice(route.prefix.length);var data=parsePathname(path0);assign(data.params,$window.history.state);function fail(){if(path0===defaultRoute)throw new Error("Could not resolve default route "+defaultRoute);setPath(defaultRoute,null,{replace:true})}loop(0);function loop(i){for(;i<compiled.length;i++){if(compiled[i].check(data)){var payload=compiled[i].component;var matchedRoute=compiled[i].route;var localComp=payload;var update=lastUpdate=function(comp){if(update!==lastUpdate)return;if(comp===SKIP)return loop(i+1);component=comp!=null&&(typeof comp.view==="function"||typeof comp==="function")?comp:"div";attrs3=data.params,currentPath=path0,lastUpdate=null;currentResolver=payload.render?payload:null;if(state===2)mountRedraw00.redraw();else{state=2;mountRedraw00.redraw.sync()}};if(payload.view||typeof payload==="function"){payload={};update(localComp)}else if(payload.onmatch){p.then(function(){return payload.onmatch(data.params,path0,matchedRoute)}).then(update,fail)}else update("div");return}}fail()}}fireAsync=function(){if(!scheduled){scheduled=true;callAsync0(resolveRoute)}};if(typeof $window.history.pushState==="function"){onremove0=function(){$window.removeEventListener("popstate",fireAsync,false)};$window.addEventListener("popstate",fireAsync,false)}else if(route.prefix[0]==="#"){fireAsync=null;onremove0=function(){$window.removeEventListener("hashchange",resolveRoute,false)};$window.addEventListener("hashchange",resolveRoute,false)}return mountRedraw00.mount(root,{onbeforeupdate:function(){state=state?2:1;return!(!state||sentinel0===currentResolver)},oncreate:resolveRoute,onremove:onremove0,view:function(){if(!state||sentinel0===currentResolver)return;var vnode5=[Vnode(component,attrs3.key,attrs3)];if(currentResolver)vnode5=currentResolver.render(vnode5[0]);return vnode5}})}route.set=function(path0,data,options){if(lastUpdate!=null){options=options||{};options.replace=true}lastUpdate=null;setPath(path0,data,options)};route.get=function(){return currentPath};route.prefix="#!";route.Link={view:function(vnode5){var options=vnode5.attrs.options;var attrs3={},onclick,href;assign(attrs3,vnode5.attrs);attrs3.selector=attrs3.options=attrs3.key=attrs3.oninit=attrs3.oncreate=attrs3.onbeforeupdate=attrs3.onupdate=attrs3.onbeforeremove=attrs3.onremove=null;var child0=m3(vnode5.attrs.selector||"a",attrs3,vnode5.children);if(child0.attrs.disabled=Boolean(child0.attrs.disabled)){child0.attrs.href=null;child0.attrs["aria-disabled"]="true";child0.attrs.onclick=null}else{onclick=child0.attrs.onclick;href=child0.attrs.href;child0.attrs.href=route.prefix+href;child0.attrs.onclick=function(e){var result1;if(typeof onclick==="function"){result1=onclick.call(e.currentTarget,e)}else if(onclick==null||typeof onclick!=="object"){}else if(typeof onclick.handleEvent==="function"){onclick.handleEvent(e)}if(result1!==false&&!e.defaultPrevented&&(e.button===0||e.which===0||e.which===1)&&(!e.currentTarget.target||e.currentTarget.target==="_self")&&!e.ctrlKey&&!e.metaKey&&!e.shiftKey&&!e.altKey){e.preventDefault();e.redraw=false;route.set(href,null,options)}}}return child0}};route.param=function(key4){return attrs3&&key4!=null?attrs3[key4]:attrs3};return route};m.route=_25(window,mountRedraw);m.render=render;m.redraw=mountRedraw.redraw;m.request=request.request;m.jsonp=request.jsonp;m.parseQueryString=parseQueryString;m.buildQueryString=buildQueryString;m.parsePathname=parsePathname;m.buildPathname=buildPathname;m.vnode=Vnode;m.PromisePolyfill=PromisePolyfill;if(typeof module!=="undefined")module["exports"]=m;else window.m=m})();(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.pica=f()}})(function(){var define,module,exports;return function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r}()({1:[function(_dereq_,module,exports){"use strict";var inherits=_dereq_("inherits");var Multimath=_dereq_("multimath");var mm_unsharp_mask=_dereq_("./mm_unsharp_mask");var mm_resize=_dereq_("./mm_resize");function MathLib(requested_features){var __requested_features=requested_features||[];var features={js:__requested_features.indexOf("js")>=0,wasm:__requested_features.indexOf("wasm")>=0};Multimath.call(this,features);this.features={js:features.js,wasm:features.wasm&&this.has_wasm()};this.use(mm_unsharp_mask);this.use(mm_resize)}inherits(MathLib,Multimath);MathLib.prototype.resizeAndUnsharp=function resizeAndUnsharp(options,cache){var result=this.resize(options,cache);if(options.unsharpAmount){this.unsharp_mask(result,options.toWidth,options.toHeight,options.unsharpAmount,options.unsharpRadius,options.unsharpThreshold)}return result};module.exports=MathLib},{"./mm_resize":4,"./mm_unsharp_mask":9,inherits:19,multimath:20}],2:[function(_dereq_,module,exports){"use strict";function clampTo8(i){return i<0?0:i>255?255:i}function convolveHorizontally(src,dest,srcW,srcH,destW,filters){var r,g,b,a;var filterPtr,filterShift,filterSize;var srcPtr,srcY,destX,filterVal;var srcOffset=0,destOffset=0;for(srcY=0;srcY<srcH;srcY++){filterPtr=0;for(destX=0;destX<destW;destX++){filterShift=filters[filterPtr++];filterSize=filters[filterPtr++];srcPtr=srcOffset+filterShift*4|0;r=g=b=a=0;for(;filterSize>0;filterSize--){filterVal=filters[filterPtr++];a=a+filterVal*src[srcPtr+3]|0;b=b+filterVal*src[srcPtr+2]|0;g=g+filterVal*src[srcPtr+1]|0;r=r+filterVal*src[srcPtr]|0;srcPtr=srcPtr+4|0}dest[destOffset+3]=clampTo8(a+(1<<13)>>14);dest[destOffset+2]=clampTo8(b+(1<<13)>>14);dest[destOffset+1]=clampTo8(g+(1<<13)>>14);dest[destOffset]=clampTo8(r+(1<<13)>>14);destOffset=destOffset+srcH*4|0}destOffset=(srcY+1)*4|0;srcOffset=(srcY+1)*srcW*4|0}}function convolveVertically(src,dest,srcW,srcH,destW,filters){var r,g,b,a;var filterPtr,filterShift,filterSize;var srcPtr,srcY,destX,filterVal;var srcOffset=0,destOffset=0;for(srcY=0;srcY<srcH;srcY++){filterPtr=0;for(destX=0;destX<destW;destX++){filterShift=filters[filterPtr++];filterSize=filters[filterPtr++];srcPtr=srcOffset+filterShift*4|0;r=g=b=a=0;for(;filterSize>0;filterSize--){filterVal=filters[filterPtr++];a=a+filterVal*src[srcPtr+3]|0;b=b+filterVal*src[srcPtr+2]|0;g=g+filterVal*src[srcPtr+1]|0;r=r+filterVal*src[srcPtr]|0;srcPtr=srcPtr+4|0}dest[destOffset+3]=clampTo8(a+(1<<13)>>14);dest[destOffset+2]=clampTo8(b+(1<<13)>>14);dest[destOffset+1]=clampTo8(g+(1<<13)>>14);dest[destOffset]=clampTo8(r+(1<<13)>>14);destOffset=destOffset+srcH*4|0}destOffset=(srcY+1)*4|0;srcOffset=(srcY+1)*srcW*4|0}}module.exports={convolveHorizontally:convolveHorizontally,convolveVertically:convolveVertically}},{}],3:[function(_dereq_,module,exports){"use strict";module.exports="AGFzbQEAAAAADAZkeWxpbmsAAAAAAAEXA2AAAGAGf39/f39/AGAHf39/f39/fwACDwEDZW52Bm1lbW9yeQIAAAMEAwABAgYGAX8AQQALB1cFEV9fd2FzbV9jYWxsX2N0b3JzAAAIY29udm9sdmUAAQpjb252b2x2ZUhWAAIMX19kc29faGFuZGxlAwAYX193YXNtX2FwcGx5X2RhdGFfcmVsb2NzAAAK7AMDAwABC8YDAQ9/AkAgA0UNACAERQ0AA0AgDCENQQAhE0EAIQcDQCAHQQJqIQYCfyAHQQF0IAVqIgcuAQIiFEUEQEGAwAAhCEGAwAAhCUGAwAAhCkGAwAAhCyAGDAELIBIgBy4BAGohCEEAIQsgFCEHQQAhDiAGIQlBACEPQQAhEANAIAUgCUEBdGouAQAiESAAIAhBAnRqKAIAIgpBGHZsIBBqIRAgCkH/AXEgEWwgC2ohCyAKQRB2Qf8BcSARbCAPaiEPIApBCHZB/wFxIBFsIA5qIQ4gCEEBaiEIIAlBAWohCSAHQQFrIgcNAAsgC0GAQGshCCAOQYBAayEJIA9BgEBrIQogEEGAQGshCyAGIBRqCyEHIAEgDUECdGogCUEOdSIGQf8BIAZB/wFIGyIGQQAgBkEAShtBCHRBgP4DcSAKQQ51IgZB/wEgBkH/AUgbIgZBACAGQQBKG0EQdEGAgPwHcSALQQ51IgZB/wEgBkH/AUgbIgZBACAGQQBKG0EYdHJyIAhBDnUiBkH/ASAGQf8BSBsiBkEAIAZBAEobcjYCACADIA1qIQ0gE0EBaiITIARHDQALIAxBAWoiDCACbCESIAMgDEcNAAsLCx4AQQAgAiADIAQgBSAAEAEgAkEAIAQgBSAGIAEQAQs="},{}],4:[function(_dereq_,module,exports){"use strict";module.exports={name:"resize",fn:_dereq_("./resize"),wasm_fn:_dereq_("./resize_wasm"),wasm_src:_dereq_("./convolve_wasm_base64")}},{"./convolve_wasm_base64":3,"./resize":5,"./resize_wasm":8}],5:[function(_dereq_,module,exports){"use strict";var createFilters=_dereq_("./resize_filter_gen");var convolveHorizontally=_dereq_("./convolve").convolveHorizontally;var convolveVertically=_dereq_("./convolve").convolveVertically;function resetAlpha(dst,width,height){var ptr=3,len=width*height*4|0;while(ptr<len){dst[ptr]=255;ptr=ptr+4|0}}module.exports=function resize(options){var src=options.src;var srcW=options.width;var srcH=options.height;var destW=options.toWidth;var destH=options.toHeight;var scaleX=options.scaleX||options.toWidth/options.width;var scaleY=options.scaleY||options.toHeight/options.height;var offsetX=options.offsetX||0;var offsetY=options.offsetY||0;var dest=options.dest||new Uint8Array(destW*destH*4);var quality=typeof options.quality==="undefined"?3:options.quality;var alpha=options.alpha||false;var filtersX=createFilters(quality,srcW,destW,scaleX,offsetX),filtersY=createFilters(quality,srcH,destH,scaleY,offsetY);var tmp=new Uint8Array(destW*srcH*4);convolveHorizontally(src,tmp,srcW,srcH,destW,filtersX);convolveVertically(tmp,dest,srcH,destW,destH,filtersY);if(!alpha)resetAlpha(dest,destW,destH);return dest}},{"./convolve":2,"./resize_filter_gen":6}],6:[function(_dereq_,module,exports){"use strict";var FILTER_INFO=_dereq_("./resize_filter_info");var FIXED_FRAC_BITS=14;function toFixedPoint(num){return Math.round(num*((1<<FIXED_FRAC_BITS)-1))}module.exports=function resizeFilterGen(quality,srcSize,destSize,scale,offset){var filterFunction=FILTER_INFO[quality].filter;var scaleInverted=1/scale;var scaleClamped=Math.min(1,scale);var srcWindow=FILTER_INFO[quality].win/scaleClamped;var destPixel,srcPixel,srcFirst,srcLast,filterElementSize,floatFilter,fxpFilter,total,pxl,idx,floatVal,filterTotal,filterVal;var leftNotEmpty,rightNotEmpty,filterShift,filterSize;var maxFilterElementSize=Math.floor((srcWindow+1)*2);var packedFilter=new Int16Array((maxFilterElementSize+2)*destSize);var packedFilterPtr=0;var slowCopy=!packedFilter.subarray||!packedFilter.set;for(destPixel=0;destPixel<destSize;destPixel++){srcPixel=(destPixel+.5)*scaleInverted+offset;srcFirst=Math.max(0,Math.floor(srcPixel-srcWindow));srcLast=Math.min(srcSize-1,Math.ceil(srcPixel+srcWindow));filterElementSize=srcLast-srcFirst+1;floatFilter=new Float32Array(filterElementSize);fxpFilter=new Int16Array(filterElementSize);total=0;for(pxl=srcFirst,idx=0;pxl<=srcLast;pxl++,idx++){floatVal=filterFunction((pxl+.5-srcPixel)*scaleClamped);total+=floatVal;floatFilter[idx]=floatVal}filterTotal=0;for(idx=0;idx<floatFilter.length;idx++){filterVal=floatFilter[idx]/total;filterTotal+=filterVal;fxpFilter[idx]=toFixedPoint(filterVal)}fxpFilter[destSize>>1]+=toFixedPoint(1-filterTotal);leftNotEmpty=0;while(leftNotEmpty<fxpFilter.length&&fxpFilter[leftNotEmpty]===0){leftNotEmpty++}if(leftNotEmpty<fxpFilter.length){rightNotEmpty=fxpFilter.length-1;while(rightNotEmpty>0&&fxpFilter[rightNotEmpty]===0){rightNotEmpty--}filterShift=srcFirst+leftNotEmpty;filterSize=rightNotEmpty-leftNotEmpty+1;packedFilter[packedFilterPtr++]=filterShift;packedFilter[packedFilterPtr++]=filterSize;if(!slowCopy){packedFilter.set(fxpFilter.subarray(leftNotEmpty,rightNotEmpty+1),packedFilterPtr);packedFilterPtr+=filterSize}else{for(idx=leftNotEmpty;idx<=rightNotEmpty;idx++){packedFilter[packedFilterPtr++]=fxpFilter[idx]}}}else{packedFilter[packedFilterPtr++]=0;packedFilter[packedFilterPtr++]=0}}return packedFilter}},{"./resize_filter_info":7}],7:[function(_dereq_,module,exports){"use strict";module.exports=[{win:.5,filter:function filter(x){return x>=-.5&&x<.5?1:0}},{win:1,filter:function filter(x){if(x<=-1||x>=1){return 0}if(x>-1.1920929e-7&&x<1.1920929e-7){return 1}var xpi=x*Math.PI;return Math.sin(xpi)/xpi*(.54+.46*Math.cos(xpi/1))}},{win:2,filter:function filter(x){if(x<=-2||x>=2){return 0}if(x>-1.1920929e-7&&x<1.1920929e-7){return 1}var xpi=x*Math.PI;return Math.sin(xpi)/xpi*Math.sin(xpi/2)/(xpi/2)}},{win:3,filter:function filter(x){if(x<=-3||x>=3){return 0}if(x>-1.1920929e-7&&x<1.1920929e-7){return 1}var xpi=x*Math.PI;return Math.sin(xpi)/xpi*Math.sin(xpi/3)/(xpi/3)}}]},{}],8:[function(_dereq_,module,exports){"use strict";var createFilters=_dereq_("./resize_filter_gen");function resetAlpha(dst,width,height){var ptr=3,len=width*height*4|0;while(ptr<len){dst[ptr]=255;ptr=ptr+4|0}}function asUint8Array(src){return new Uint8Array(src.buffer,0,src.byteLength)}var IS_LE=true;try{IS_LE=new Uint32Array(new Uint8Array([1,0,0,0]).buffer)[0]===1}catch(__){}function copyInt16asLE(src,target,target_offset){if(IS_LE){target.set(asUint8Array(src),target_offset);return}for(var ptr=target_offset,i=0;i<src.length;i++){var data=src[i];target[ptr++]=data&255;target[ptr++]=data>>8&255}}module.exports=function resize_wasm(options){var src=options.src;var srcW=options.width;var srcH=options.height;var destW=options.toWidth;var destH=options.toHeight;var scaleX=options.scaleX||options.toWidth/options.width;var scaleY=options.scaleY||options.toHeight/options.height;var offsetX=options.offsetX||0;var offsetY=options.offsetY||0;var dest=options.dest||new Uint8Array(destW*destH*4);var quality=typeof options.quality==="undefined"?3:options.quality;var alpha=options.alpha||false;var filtersX=createFilters(quality,srcW,destW,scaleX,offsetX),filtersY=createFilters(quality,srcH,destH,scaleY,offsetY);var src_offset=0;var tmp_offset=this.__align(src_offset+Math.max(src.byteLength,dest.byteLength));var filtersX_offset=this.__align(tmp_offset+srcH*destW*4);var filtersY_offset=this.__align(filtersX_offset+filtersX.byteLength);var alloc_bytes=filtersY_offset+filtersY.byteLength;var instance=this.__instance("resize",alloc_bytes);var mem=new Uint8Array(this.__memory.buffer);var mem32=new Uint32Array(this.__memory.buffer);var src32=new Uint32Array(src.buffer);mem32.set(src32);copyInt16asLE(filtersX,mem,filtersX_offset);copyInt16asLE(filtersY,mem,filtersY_offset);var fn=instance.exports.convolveHV||instance.exports._convolveHV;fn(filtersX_offset,filtersY_offset,tmp_offset,srcW,srcH,destW,destH);var dest32=new Uint32Array(dest.buffer);dest32.set(new Uint32Array(this.__memory.buffer,0,destH*destW));if(!alpha)resetAlpha(dest,destW,destH);return dest}},{"./resize_filter_gen":6}],9:[function(_dereq_,module,exports){"use strict";module.exports={name:"unsharp_mask",fn:_dereq_("./unsharp_mask"),wasm_fn:_dereq_("./unsharp_mask_wasm"),wasm_src:_dereq_("./unsharp_mask_wasm_base64")}},{"./unsharp_mask":10,"./unsharp_mask_wasm":11,"./unsharp_mask_wasm_base64":12}],10:[function(_dereq_,module,exports){"use strict";var glur_mono16=_dereq_("glur/mono16");function hsv_v16(img,width,height){var size=width*height;var out=new Uint16Array(size);var r,g,b,max;for(var i=0;i<size;i++){r=img[4*i];g=img[4*i+1];b=img[4*i+2];max=r>=g&&r>=b?r:g>=b&&g>=r?g:b;out[i]=max<<8}return out}module.exports=function unsharp(img,width,height,amount,radius,threshold){var v1,v2,vmul;var diff,iTimes4;if(amount===0||radius<.5){return}if(radius>2){radius=2}var brightness=hsv_v16(img,width,height);var blured=new Uint16Array(brightness);glur_mono16(blured,width,height,radius);var amountFp=amount/100*4096+.5|0;var thresholdFp=threshold<<8;var size=width*height;for(var i=0;i<size;i++){v1=brightness[i];diff=v1-blured[i];if(Math.abs(diff)>=thresholdFp){v2=v1+(amountFp*diff+2048>>12);v2=v2>65280?65280:v2;v2=v2<0?0:v2;v1=v1!==0?v1:1;vmul=(v2<<12)/v1|0;iTimes4=i*4;img[iTimes4]=img[iTimes4]*vmul+2048>>12;img[iTimes4+1]=img[iTimes4+1]*vmul+2048>>12;img[iTimes4+2]=img[iTimes4+2]*vmul+2048>>12}}}},{"glur/mono16":18}],11:[function(_dereq_,module,exports){"use strict";module.exports=function unsharp(img,width,height,amount,radius,threshold){if(amount===0||radius<.5){return}if(radius>2){radius=2}var pixels=width*height;var img_bytes_cnt=pixels*4;var hsv_bytes_cnt=pixels*2;var blur_bytes_cnt=pixels*2;var blur_line_byte_cnt=Math.max(width,height)*4;var blur_coeffs_byte_cnt=8*4;var img_offset=0;var hsv_offset=img_bytes_cnt;var blur_offset=hsv_offset+hsv_bytes_cnt;var blur_tmp_offset=blur_offset+blur_bytes_cnt;var blur_line_offset=blur_tmp_offset+blur_bytes_cnt;var blur_coeffs_offset=blur_line_offset+blur_line_byte_cnt;var instance=this.__instance("unsharp_mask",img_bytes_cnt+hsv_bytes_cnt+blur_bytes_cnt*2+blur_line_byte_cnt+blur_coeffs_byte_cnt,{exp:Math.exp});var img32=new Uint32Array(img.buffer);var mem32=new Uint32Array(this.__memory.buffer);mem32.set(img32);var fn=instance.exports.hsv_v16||instance.exports._hsv_v16;fn(img_offset,hsv_offset,width,height);fn=instance.exports.blurMono16||instance.exports._blurMono16;fn(hsv_offset,blur_offset,blur_tmp_offset,blur_line_offset,blur_coeffs_offset,width,height,radius);fn=instance.exports.unsharp||instance.exports._unsharp;fn(img_offset,img_offset,hsv_offset,blur_offset,width,height,amount,threshold);img32.set(new Uint32Array(this.__memory.buffer,0,pixels))}},{}],12:[function(_dereq_,module,exports){"use strict";module.exports="AGFzbQEAAAAADAZkeWxpbmsAAAAAAAE0B2AAAGAEf39/fwBgBn9/f39/fwBgCH9/f39/f39/AGAIf39/f39/f30AYAJ9fwBgAXwBfAIZAgNlbnYDZXhwAAYDZW52Bm1lbW9yeQIAAAMHBgAFAgQBAwYGAX8AQQALB4oBCBFfX3dhc21fY2FsbF9jdG9ycwABFl9fYnVpbGRfZ2F1c3NpYW5fY29lZnMAAg5fX2dhdXNzMTZfbGluZQADCmJsdXJNb25vMTYABAdoc3ZfdjE2AAUHdW5zaGFycAAGDF9fZHNvX2hhbmRsZQMAGF9fd2FzbV9hcHBseV9kYXRhX3JlbG9jcwABCsUMBgMAAQvWAQEHfCABRNuGukOCGvs/IAC7oyICRAAAAAAAAADAohAAIgW2jDgCFCABIAKaEAAiAyADoCIGtjgCECABRAAAAAAAAPA/IAOhIgQgBKIgAyACIAKgokQAAAAAAADwP6AgBaGjIgS2OAIAIAEgBSAEmqIiB7Y4AgwgASADIAJEAAAAAAAA8D+gIASioiIItjgCCCABIAMgAkQAAAAAAADwv6AgBKKiIgK2OAIEIAEgByAIoCAFRAAAAAAAAPA/IAahoCIDo7Y4AhwgASAEIAKgIAOjtjgCGAuGBQMGfwl8An0gAyoCDCEVIAMqAgghFiADKgIUuyERIAMqAhC7IRACQCAEQQFrIghBAEgiCQRAIAIhByAAIQYMAQsgAiAALwEAuCIPIAMqAhi7oiIMIBGiIg0gDCAQoiAPIAMqAgS7IhOiIhQgAyoCALsiEiAPoqCgoCIOtjgCACACQQRqIQcgAEECaiEGIAhFDQAgCEEBIAhBAUgbIgpBf3MhCwJ/IAQgCmtBAXFFBEAgDiENIAgMAQsgAiANIA4gEKIgFCASIAAvAQK4Ig+ioKCgIg22OAIEIAJBCGohByAAQQRqIQYgDiEMIARBAmsLIQIgC0EAIARrRg0AA0AgByAMIBGiIA0gEKIgDyAToiASIAYvAQC4Ig6ioKCgIgy2OAIAIAcgDSARoiAMIBCiIA4gE6IgEiAGLwECuCIPoqCgoCINtjgCBCAHQQhqIQcgBkEEaiEGIAJBAkohACACQQJrIQIgAA0ACwsCQCAJDQAgASAFIAhsQQF0aiIAAn8gBkECay8BACICuCINIBW7IhKiIA0gFrsiE6KgIA0gAyoCHLuiIgwgEKKgIAwgEaKgIg8gB0EEayIHKgIAu6AiDkQAAAAAAADwQWMgDkQAAAAAAAAAAGZxBEAgDqsMAQtBAAs7AQAgCEUNACAGQQRrIQZBACAFa0EBdCEBA0ACfyANIBKiIAJB//8DcbgiDSAToqAgDyIOIBCioCAMIBGioCIPIAdBBGsiByoCALugIgxEAAAAAAAA8EFjIAxEAAAAAAAAAABmcQRAIAyrDAELQQALIQMgBi8BACECIAAgAWoiACADOwEAIAZBAmshBiAIQQFKIQMgDiEMIAhBAWshCCADDQALCwvRAgIBfwd8AkAgB0MAAAAAWw0AIARE24a6Q4Ia+z8gB0MAAAA/l7ujIglEAAAAAAAAAMCiEAAiDLaMOAIUIAQgCZoQACIKIAqgIg22OAIQIAREAAAAAAAA8D8gCqEiCyALoiAKIAkgCaCiRAAAAAAAAPA/oCAMoaMiC7Y4AgAgBCAMIAuaoiIOtjgCDCAEIAogCUQAAAAAAADwP6AgC6KiIg+2OAIIIAQgCiAJRAAAAAAAAPC/oCALoqIiCbY4AgQgBCAOIA+gIAxEAAAAAAAA8D8gDaGgIgqjtjgCHCAEIAsgCaAgCqO2OAIYIAYEQANAIAAgBSAIbEEBdGogAiAIQQF0aiADIAQgBSAGEAMgCEEBaiIIIAZHDQALCyAFRQ0AQQAhCANAIAIgBiAIbEEBdGogASAIQQF0aiADIAQgBiAFEAMgCEEBaiIIIAVHDQALCwtxAQN/IAIgA2wiBQRAA0AgASAAKAIAIgRBEHZB/wFxIgIgAiAEQQh2Qf8BcSIDIAMgBEH/AXEiBEkbIAIgA0sbIgYgBiAEIAIgBEsbIAMgBEsbQQh0OwEAIAFBAmohASAAQQRqIQAgBUEBayIFDQALCwuZAgIDfwF8IAQgBWwhBAJ/IAazQwAAgEWUQwAAyEKVu0QAAAAAAADgP6AiC5lEAAAAAAAA4EFjBEAgC6oMAQtBgICAgHgLIQUgBARAIAdBCHQhCUEAIQYDQCAJIAIgBkEBdCIHai8BACIBIAMgB2ovAQBrIgcgB0EfdSIIaiAIc00EQCAAIAZBAnQiCGoiCiAFIAdsQYAQakEMdSABaiIHQYD+AyAHQYD+A0gbIgdBACAHQQBKG0EMdCABQQEgARtuIgEgCi0AAGxBgBBqQQx2OgAAIAAgCEEBcmoiByABIActAABsQYAQakEMdjoAACAAIAhBAnJqIgcgASAHLQAAbEGAEGpBDHY6AAALIAZBAWoiBiAERw0ACwsL"},{}],13:[function(_dereq_,module,exports){"use strict";var GC_INTERVAL=100;function Pool(create,idle){this.create=create;this.available=[];this.acquired={};this.lastId=1;this.timeoutId=0;this.idle=idle||2e3}Pool.prototype.acquire=function(){var _this=this;var resource;if(this.available.length!==0){resource=this.available.pop()}else{resource=this.create();resource.id=this.lastId++;resource.release=function(){return _this.release(resource)}}this.acquired[resource.id]=resource;return resource};Pool.prototype.release=function(resource){var _this2=this;delete this.acquired[resource.id];resource.lastUsed=Date.now();this.available.push(resource);if(this.timeoutId===0){this.timeoutId=setTimeout(function(){return _this2.gc()},GC_INTERVAL)}};Pool.prototype.gc=function(){var _this3=this;var now=Date.now();this.available=this.available.filter(function(resource){if(now-resource.lastUsed>_this3.idle){resource.destroy();return false}return true});if(this.available.length!==0){this.timeoutId=setTimeout(function(){return _this3.gc()},GC_INTERVAL)}else{this.timeoutId=0}};module.exports=Pool},{}],14:[function(_dereq_,module,exports){"use strict";var MIN_INNER_TILE_SIZE=2;module.exports=function createStages(fromWidth,fromHeight,toWidth,toHeight,srcTileSize,destTileBorder){var scaleX=toWidth/fromWidth;var scaleY=toHeight/fromHeight;var minScale=(2*destTileBorder+MIN_INNER_TILE_SIZE+1)/srcTileSize;if(minScale>.5)return[[toWidth,toHeight]];var stageCount=Math.ceil(Math.log(Math.min(scaleX,scaleY))/Math.log(minScale));if(stageCount<=1)return[[toWidth,toHeight]];var result=[];for(var i=0;i<stageCount;i++){var width=Math.round(Math.pow(Math.pow(fromWidth,stageCount-i-1)*Math.pow(toWidth,i+1),1/stageCount));var height=Math.round(Math.pow(Math.pow(fromHeight,stageCount-i-1)*Math.pow(toHeight,i+1),1/stageCount));result.push([width,height])}return result}},{}],15:[function(_dereq_,module,exports){"use strict";var PIXEL_EPSILON=1e-5;function pixelFloor(x){var nearest=Math.round(x);if(Math.abs(x-nearest)<PIXEL_EPSILON){return nearest}return Math.floor(x)}function pixelCeil(x){var nearest=Math.round(x);if(Math.abs(x-nearest)<PIXEL_EPSILON){return nearest}return Math.ceil(x)}module.exports=function createRegions(options){var scaleX=options.toWidth/options.width;var scaleY=options.toHeight/options.height;var innerTileWidth=pixelFloor(options.srcTileSize*scaleX)-2*options.destTileBorder;var innerTileHeight=pixelFloor(options.srcTileSize*scaleY)-2*options.destTileBorder;if(innerTileWidth<1||innerTileHeight<1){throw new Error("Internal error in pica: target tile width/height is too small.")}var x,y;var innerX,innerY,toTileWidth,toTileHeight;var tiles=[];var tile;for(innerY=0;innerY<options.toHeight;innerY+=innerTileHeight){for(innerX=0;innerX<options.toWidth;innerX+=innerTileWidth){x=innerX-options.destTileBorder;if(x<0){x=0}toTileWidth=innerX+innerTileWidth+options.destTileBorder-x;if(x+toTileWidth>=options.toWidth){toTileWidth=options.toWidth-x}y=innerY-options.destTileBorder;if(y<0){y=0}toTileHeight=innerY+innerTileHeight+options.destTileBorder-y;if(y+toTileHeight>=options.toHeight){toTileHeight=options.toHeight-y}tile={toX:x,toY:y,toWidth:toTileWidth,toHeight:toTileHeight,toInnerX:innerX,toInnerY:innerY,toInnerWidth:innerTileWidth,toInnerHeight:innerTileHeight,offsetX:x/scaleX-pixelFloor(x/scaleX),offsetY:y/scaleY-pixelFloor(y/scaleY),scaleX:scaleX,scaleY:scaleY,x:pixelFloor(x/scaleX),y:pixelFloor(y/scaleY),width:pixelCeil(toTileWidth/scaleX),height:pixelCeil(toTileHeight/scaleY)};tiles.push(tile)}}return tiles}},{}],16:[function(_dereq_,module,exports){"use strict";function objClass(obj){return Object.prototype.toString.call(obj)}module.exports.isCanvas=function isCanvas(element){var cname=objClass(element);return cname==="[object HTMLCanvasElement]"||cname==="[object OffscreenCanvas]"||cname==="[object Canvas]"};module.exports.isImage=function isImage(element){return objClass(element)==="[object HTMLImageElement]"};module.exports.isImageBitmap=function isImageBitmap(element){return objClass(element)==="[object ImageBitmap]"};module.exports.limiter=function limiter(concurrency){var active=0,queue=[];function roll(){if(active<concurrency&&queue.length){active++;queue.shift()()}}return function limit(fn){return new Promise(function(resolve,reject){queue.push(function(){fn().then(function(result){resolve(result);active--;roll()},function(err){reject(err);active--;roll()})});roll()})}};module.exports.cib_quality_name=function cib_quality_name(num){switch(num){case 0:return"pixelated";case 1:return"low";case 2:return"medium"}return"high"};module.exports.cib_support=function cib_support(createCanvas){return Promise.resolve().then(function(){if(typeof createImageBitmap==="undefined"){return false}var c=createCanvas(100,100);return createImageBitmap(c,0,0,100,100,{resizeWidth:10,resizeHeight:10,resizeQuality:"high"}).then(function(bitmap){var status=bitmap.width===10;bitmap.close();c=null;return status})})["catch"](function(){return false})};module.exports.worker_offscreen_canvas_support=function worker_offscreen_canvas_support(){return new Promise(function(resolve,reject){function workerPayload(self){Promise.resolve().then(function(){var canvas=new OffscreenCanvas(10,10);var ctx=canvas.getContext("2d");ctx.rect(0,0,1,1);return createImageBitmap(canvas,0,0,1,1)}).then(function(){return self.postMessage(true)},function(){return self.postMessage(false)})}var code=btoa("(".concat(workerPayload.toString(),")(self);"));var w=new Worker("data:text/javascript;base64,".concat(code));w.onmessage=function(ev){return ev.data?resolve():reject()};w.onerror=reject})}},{}],17:[function(_dereq_,module,exports){"use strict";module.exports=function(){var MathLib=_dereq_("./mathlib");var mathLib;onmessage=function onmessage(ev){var tileOpts=ev.data.opts;var returnBitmap=false;if(!tileOpts.src&&tileOpts.srcBitmap){var canvas=new OffscreenCanvas(tileOpts.width,tileOpts.height);var ctx=canvas.getContext("2d",{alpha:Boolean(tileOpts.alpha)});ctx.drawImage(tileOpts.srcBitmap,0,0);tileOpts.src=ctx.getImageData(0,0,tileOpts.width,tileOpts.height).data;canvas.width=canvas.height=0;canvas=null;tileOpts.srcBitmap.close();tileOpts.srcBitmap=null;returnBitmap=true}if(!mathLib)mathLib=new MathLib(ev.data.features);var data=mathLib.resizeAndUnsharp(tileOpts);if(returnBitmap){var toImageData=new ImageData(new Uint8ClampedArray(data),tileOpts.toWidth,tileOpts.toHeight);var _canvas=new OffscreenCanvas(tileOpts.toWidth,tileOpts.toHeight);var _ctx=_canvas.getContext("2d",{alpha:Boolean(tileOpts.alpha)});_ctx.putImageData(toImageData,0,0);createImageBitmap(_canvas).then(function(bitmap){postMessage({bitmap:bitmap},[bitmap])})}else{postMessage({data:data},[data.buffer])}}}},{"./mathlib":1}],18:[function(_dereq_,module,exports){var a0,a1,a2,a3,b1,b2,left_corner,right_corner;function gaussCoef(sigma){if(sigma<.5){sigma=.5}var a=Math.exp(.726*.726)/sigma,g1=Math.exp(-a),g2=Math.exp(-2*a),k=(1-g1)*(1-g1)/(1+2*a*g1-g2);a0=k;a1=k*(a-1)*g1;a2=k*(a+1)*g1;a3=-k*g2;b1=2*g1;b2=-g2;left_corner=(a0+a1)/(1-b1-b2);right_corner=(a2+a3)/(1-b1-b2);return new Float32Array([a0,a1,a2,a3,b1,b2,left_corner,right_corner])}function convolveMono16(src,out,line,coeff,width,height){var prev_src,curr_src,curr_out,prev_out,prev_prev_out;var src_index,out_index,line_index;var i,j;var coeff_a0,coeff_a1,coeff_b1,coeff_b2;for(i=0;i<height;i++){src_index=i*width;out_index=i;line_index=0;prev_src=src[src_index];prev_prev_out=prev_src*coeff[6];prev_out=prev_prev_out;coeff_a0=coeff[0];coeff_a1=coeff[1];coeff_b1=coeff[4];coeff_b2=coeff[5];for(j=0;j<width;j++){curr_src=src[src_index];curr_out=curr_src*coeff_a0+prev_src*coeff_a1+prev_out*coeff_b1+prev_prev_out*coeff_b2;prev_prev_out=prev_out;prev_out=curr_out;prev_src=curr_src;line[line_index]=prev_out;line_index++;src_index++}src_index--;line_index--;out_index+=height*(width-1);prev_src=src[src_index];prev_prev_out=prev_src*coeff[7];prev_out=prev_prev_out;curr_src=prev_src;coeff_a0=coeff[2];coeff_a1=coeff[3];for(j=width-1;j>=0;j--){curr_out=curr_src*coeff_a0+prev_src*coeff_a1+prev_out*coeff_b1+prev_prev_out*coeff_b2;prev_prev_out=prev_out;prev_out=curr_out;prev_src=curr_src;curr_src=src[src_index];out[out_index]=line[line_index]+prev_out;src_index--;line_index--;out_index-=height}}}function blurMono16(src,width,height,radius){if(!radius){return}var out=new Uint16Array(src.length),tmp_line=new Float32Array(Math.max(width,height));var coeff=gaussCoef(radius);convolveMono16(src,out,tmp_line,coeff,width,height,radius);convolveMono16(out,src,tmp_line,coeff,height,width,radius)}module.exports=blurMono16},{}],19:[function(_dereq_,module,exports){if(typeof Object.create==="function"){module.exports=function inherits(ctor,superCtor){if(superCtor){ctor.super_=superCtor;ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}})}}}else{module.exports=function inherits(ctor,superCtor){if(superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype;ctor.prototype=new TempCtor;ctor.prototype.constructor=ctor}}}},{}],20:[function(_dereq_,module,exports){"use strict";var assign=_dereq_("object-assign");var base64decode=_dereq_("./lib/base64decode");var hasWebAssembly=_dereq_("./lib/wa_detect");var DEFAULT_OPTIONS={js:true,wasm:true};function MultiMath(options){if(!(this instanceof MultiMath))return new MultiMath(options);var opts=assign({},DEFAULT_OPTIONS,options||{});this.options=opts;this.__cache={};this.__init_promise=null;this.__modules=opts.modules||{};this.__memory=null;this.__wasm={};this.__isLE=new Uint32Array(new Uint8Array([1,0,0,0]).buffer)[0]===1;if(!this.options.js&&!this.options.wasm){throw new Error('mathlib: at least "js" or "wasm" should be enabled')}}MultiMath.prototype.has_wasm=hasWebAssembly;MultiMath.prototype.use=function(module){this.__modules[module.name]=module;if(this.options.wasm&&this.has_wasm()&&module.wasm_fn){this[module.name]=module.wasm_fn}else{this[module.name]=module.fn}return this};MultiMath.prototype.init=function(){if(this.__init_promise)return this.__init_promise;if(!this.options.js&&this.options.wasm&&!this.has_wasm()){return Promise.reject(new Error('mathlib: only "wasm" was enabled, but it\'s not supported'))}var self=this;this.__init_promise=Promise.all(Object.keys(self.__modules).map(function(name){var module=self.__modules[name];if(!self.options.wasm||!self.has_wasm()||!module.wasm_fn)return null;if(self.__wasm[name])return null;return WebAssembly.compile(self.__base64decode(module.wasm_src)).then(function(m){self.__wasm[name]=m})})).then(function(){return self});return this.__init_promise};MultiMath.prototype.__base64decode=base64decode;MultiMath.prototype.__reallocate=function mem_grow_to(bytes){if(!this.__memory){this.__memory=new WebAssembly.Memory({initial:Math.ceil(bytes/(64*1024))});return this.__memory}var mem_size=this.__memory.buffer.byteLength;if(mem_size<bytes){this.__memory.grow(Math.ceil((bytes-mem_size)/(64*1024)))}return this.__memory};MultiMath.prototype.__instance=function instance(name,memsize,env_extra){if(memsize)this.__reallocate(memsize);if(!this.__wasm[name]){var module=this.__modules[name];this.__wasm[name]=new WebAssembly.Module(this.__base64decode(module.wasm_src))}if(!this.__cache[name]){var env_base={memoryBase:0,memory:this.__memory,tableBase:0,table:new WebAssembly.Table({initial:0,element:"anyfunc"})};this.__cache[name]=new WebAssembly.Instance(this.__wasm[name],{env:assign(env_base,env_extra||{})})}return this.__cache[name]};MultiMath.prototype.__align=function align(number,base){base=base||8;var reminder=number%base;return number+(reminder?base-reminder:0)};module.exports=MultiMath},{"./lib/base64decode":21,"./lib/wa_detect":22,"object-assign":23}],21:[function(_dereq_,module,exports){"use strict";var BASE64_MAP="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";module.exports=function base64decode(str){var input=str.replace(/[\r\n=]/g,""),max=input.length;var out=new Uint8Array(max*3>>2);var bits=0;var ptr=0;for(var idx=0;idx<max;idx++){if(idx%4===0&&idx){out[ptr++]=bits>>16&255;out[ptr++]=bits>>8&255;out[ptr++]=bits&255}bits=bits<<6|BASE64_MAP.indexOf(input.charAt(idx))}var tailbits=max%4*6;if(tailbits===0){out[ptr++]=bits>>16&255;out[ptr++]=bits>>8&255;out[ptr++]=bits&255}else if(tailbits===18){out[ptr++]=bits>>10&255;out[ptr++]=bits>>2&255}else if(tailbits===12){out[ptr++]=bits>>4&255}return out}},{}],22:[function(_dereq_,module,exports){"use strict";var wa;module.exports=function hasWebAssembly(){if(typeof wa!=="undefined")return wa;wa=false;if(typeof WebAssembly==="undefined")return wa;try{var bin=new Uint8Array([0,97,115,109,1,0,0,0,1,6,1,96,1,127,1,127,3,2,1,0,5,3,1,0,1,7,8,1,4,116,101,115,116,0,0,10,16,1,14,0,32,0,65,1,54,2,0,32,0,40,2,0,11]);var module=new WebAssembly.Module(bin);var instance=new WebAssembly.Instance(module,{});if(instance.exports.test(4)!==0)wa=true;return wa}catch(__){}return wa}},{}],23:[function(_dereq_,module,exports){"use strict";var getOwnPropertySymbols=Object.getOwnPropertySymbols;var hasOwnProperty=Object.prototype.hasOwnProperty;var propIsEnumerable=Object.prototype.propertyIsEnumerable;function toObject(val){if(val===null||val===undefined){throw new TypeError("Object.assign cannot be called with null or undefined")}return Object(val)}function shouldUseNative(){try{if(!Object.assign){return false}var test1=new String("abc");test1[5]="de";if(Object.getOwnPropertyNames(test1)[0]==="5"){return false}var test2={};for(var i=0;i<10;i++){test2["_"+String.fromCharCode(i)]=i}var order2=Object.getOwnPropertyNames(test2).map(function(n){return test2[n]});if(order2.join("")!=="0123456789"){return false}var test3={};"abcdefghijklmnopqrst".split("").forEach(function(letter){test3[letter]=letter});if(Object.keys(Object.assign({},test3)).join("")!=="abcdefghijklmnopqrst"){return false}return true}catch(err){return false}}module.exports=shouldUseNative()?Object.assign:function(target,source){var from;var to=toObject(target);var symbols;for(var s=1;s<arguments.length;s++){from=Object(arguments[s]);for(var key in from){if(hasOwnProperty.call(from,key)){to[key]=from[key]}}if(getOwnPropertySymbols){symbols=getOwnPropertySymbols(from);for(var i=0;i<symbols.length;i++){if(propIsEnumerable.call(from,symbols[i])){to[symbols[i]]=from[symbols[i]]}}}}return to}},{}],24:[function(_dereq_,module,exports){var bundleFn=arguments[3];var sources=arguments[4];var cache=arguments[5];var stringify=JSON.stringify;module.exports=function(fn,options){var wkey;var cacheKeys=Object.keys(cache);for(var i=0,l=cacheKeys.length;i<l;i++){var key=cacheKeys[i];var exp=cache[key].exports;if(exp===fn||exp&&exp.default===fn){wkey=key;break}}if(!wkey){wkey=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var wcache={};for(var i=0,l=cacheKeys.length;i<l;i++){var key=cacheKeys[i];wcache[key]=key}sources[wkey]=["function(require,module,exports){"+fn+"(self); }",wcache]}var skey=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var scache={};scache[wkey]=wkey;sources[skey]=["function(require,module,exports){"+"var f = require("+stringify(wkey)+");"+"(f.default ? f.default : f)(self);"+"}",scache];var workerSources={};resolveSources(skey);function resolveSources(key){workerSources[key]=true;for(var depPath in sources[key][1]){var depKey=sources[key][1][depPath];if(!workerSources[depKey]){resolveSources(depKey)}}}var src="("+bundleFn+")({"+Object.keys(workerSources).map(function(key){return stringify(key)+":["+sources[key][0]+","+stringify(sources[key][1])+"]"}).join(",")+"},{},["+stringify(skey)+"])";var URL=window.URL||window.webkitURL||window.mozURL||window.msURL;var blob=new Blob([src],{type:"text/javascript"});if(options&&options.bare){return blob}var workerUrl=URL.createObjectURL(blob);var worker=new Worker(workerUrl);worker.objectURL=workerUrl;return worker}},{}],"/index.js":[function(_dereq_,module,exports){"use strict";function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}function _iterableToArrayLimit(arr,i){var _i=arr&&(typeof Symbol!=="undefined"&&arr[Symbol.iterator]||arr["@@iterator"]);if(_i==null)return;var _arr=[];var _n=true;var _d=false;var _s,_e;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}var assign=_dereq_("object-assign");var webworkify=_dereq_("webworkify");var MathLib=_dereq_("./lib/mathlib");var Pool=_dereq_("./lib/pool");var utils=_dereq_("./lib/utils");var worker=_dereq_("./lib/worker");var createStages=_dereq_("./lib/stepper");var createRegions=_dereq_("./lib/tiler");var singletones={};var NEED_SAFARI_FIX=false;try{if(typeof navigator!=="undefined"&&navigator.userAgent){NEED_SAFARI_FIX=navigator.userAgent.indexOf("Safari")>=0}}catch(e){}var concurrency=1;if(typeof navigator!=="undefined"){concurrency=Math.min(navigator.hardwareConcurrency||1,4)}var DEFAULT_PICA_OPTS={tile:1024,concurrency:concurrency,features:["js","wasm","ww"],idle:2e3,createCanvas:function createCanvas(width,height){var tmpCanvas=document.createElement("canvas");tmpCanvas.width=width;tmpCanvas.height=height;return tmpCanvas}};var DEFAULT_RESIZE_OPTS={quality:3,alpha:false,unsharpAmount:0,unsharpRadius:0,unsharpThreshold:0};var CAN_NEW_IMAGE_DATA;var CAN_CREATE_IMAGE_BITMAP;var CAN_USE_OFFSCREEN_CANVAS;function workerFabric(){return{value:webworkify(worker),destroy:function destroy(){this.value.terminate();if(typeof window!=="undefined"){var url=window.URL||window.webkitURL||window.mozURL||window.msURL;if(url&&url.revokeObjectURL&&this.value.objectURL){url.revokeObjectURL(this.value.objectURL)}}}}}function Pica(options){if(!(this instanceof Pica))return new Pica(options);this.options=assign({},DEFAULT_PICA_OPTS,options||{});var limiter_key="lk_".concat(this.options.concurrency);this.__limit=singletones[limiter_key]||utils.limiter(this.options.concurrency);if(!singletones[limiter_key])singletones[limiter_key]=this.__limit;this.features={js:false,wasm:false,cib:false,ww:false};this.__workersPool=null;this.__requested_features=[];this.__mathlib=null}Pica.prototype.init=function(){var _this=this;if(this.__initPromise)return this.__initPromise;if(CAN_NEW_IMAGE_DATA!==false&&CAN_NEW_IMAGE_DATA!==true){CAN_NEW_IMAGE_DATA=false;if(typeof ImageData!=="undefined"&&typeof Uint8ClampedArray!=="undefined"){try{new ImageData(new Uint8ClampedArray(400),10,10);CAN_NEW_IMAGE_DATA=true}catch(__){}}}if(CAN_CREATE_IMAGE_BITMAP!==false&&CAN_CREATE_IMAGE_BITMAP!==true){CAN_CREATE_IMAGE_BITMAP=false;if(typeof ImageBitmap!=="undefined"){if(ImageBitmap.prototype&&ImageBitmap.prototype.close){CAN_CREATE_IMAGE_BITMAP=true}else{this.debug("ImageBitmap does not support .close(), disabled")}}}var features=this.options.features.slice();if(features.indexOf("all")>=0){features=["cib","wasm","js","ww"]}this.__requested_features=features;this.__mathlib=new MathLib(features);if(features.indexOf("ww")>=0){if(typeof window!=="undefined"&&"Worker"in window){try{var wkr=_dereq_("webworkify")(function(){});wkr.terminate();this.features.ww=true;var wpool_key="wp_".concat(JSON.stringify(this.options));if(singletones[wpool_key]){this.__workersPool=singletones[wpool_key]}else{this.__workersPool=new Pool(workerFabric,this.options.idle);singletones[wpool_key]=this.__workersPool}}catch(__){}}}var initMath=this.__mathlib.init().then(function(mathlib){assign(_this.features,mathlib.features)});var checkCibResize;if(!CAN_CREATE_IMAGE_BITMAP){checkCibResize=Promise.resolve(false)}else{checkCibResize=utils.cib_support(this.options.createCanvas).then(function(status){if(_this.features.cib&&features.indexOf("cib")<0){_this.debug("createImageBitmap() resize supported, but disabled by config");return}if(features.indexOf("cib")>=0)_this.features.cib=status})}var checkOffscreenCanvas;if(CAN_CREATE_IMAGE_BITMAP&&CAN_NEW_IMAGE_DATA&&features.indexOf("ww")!==-1){checkOffscreenCanvas=utils.worker_offscreen_canvas_support()}else{checkOffscreenCanvas=Promise.reject()}checkOffscreenCanvas=checkOffscreenCanvas.then(function(){CAN_USE_OFFSCREEN_CANVAS=true},function(){CAN_USE_OFFSCREEN_CANVAS=false});this.__initPromise=Promise.all([initMath,checkCibResize,checkOffscreenCanvas]).then(function(){return _this});return this.__initPromise};Pica.prototype.__invokeResize=function(tileOpts,opts){var _this2=this;opts.__mathCache=opts.__mathCache||{};return Promise.resolve().then(function(){if(!_this2.features.ww){return{data:_this2.__mathlib.resizeAndUnsharp(tileOpts,opts.__mathCache)}}return new Promise(function(resolve,reject){var w=_this2.__workersPool.acquire();if(opts.cancelToken)opts.cancelToken["catch"](function(err){return reject(err)});w.value.onmessage=function(ev){w.release();if(ev.data.err)reject(ev.data.err);else resolve(ev.data)};var transfer=[];if(tileOpts.src)transfer.push(tileOpts.src.buffer);if(tileOpts.srcBitmap)transfer.push(tileOpts.srcBitmap);w.value.postMessage({opts:tileOpts,features:_this2.__requested_features,preload:{wasm_nodule:_this2.__mathlib.__}},transfer)})})};Pica.prototype.__extractTileData=function(tile,from,opts,stageEnv,extractTo){if(this.features.ww&&CAN_USE_OFFSCREEN_CANVAS){this.debug("Create tile for OffscreenCanvas");return createImageBitmap(stageEnv.srcImageBitmap||from,tile.x,tile.y,tile.width,tile.height).then(function(bitmap){extractTo.srcBitmap=bitmap;return extractTo})}if(utils.isCanvas(from)){if(!stageEnv.srcCtx)stageEnv.srcCtx=from.getContext("2d",{alpha:Boolean(opts.alpha)});this.debug("Get tile pixel data");extractTo.src=stageEnv.srcCtx.getImageData(tile.x,tile.y,tile.width,tile.height).data;return extractTo}this.debug("Draw tile imageBitmap/image to temporary canvas");var tmpCanvas=this.options.createCanvas(tile.width,tile.height);var tmpCtx=tmpCanvas.getContext("2d",{alpha:Boolean(opts.alpha)});tmpCtx.globalCompositeOperation="copy";tmpCtx.drawImage(stageEnv.srcImageBitmap||from,tile.x,tile.y,tile.width,tile.height,0,0,tile.width,tile.height);this.debug("Get tile pixel data");extractTo.src=tmpCtx.getImageData(0,0,tile.width,tile.height).data;tmpCanvas.width=tmpCanvas.height=0;return extractTo};Pica.prototype.__landTileData=function(tile,result,stageEnv){var toImageData;this.debug("Convert raw rgba tile result to ImageData");if(result.bitmap){stageEnv.toCtx.drawImage(result.bitmap,tile.toX,tile.toY);return null}if(CAN_NEW_IMAGE_DATA){toImageData=new ImageData(new Uint8ClampedArray(result.data),tile.toWidth,tile.toHeight)}else{toImageData=stageEnv.toCtx.createImageData(tile.toWidth,tile.toHeight);if(toImageData.data.set){toImageData.data.set(result.data)}else{for(var i=toImageData.data.length-1;i>=0;i--){toImageData.data[i]=result.data[i]}}}this.debug("Draw tile");if(NEED_SAFARI_FIX){stageEnv.toCtx.putImageData(toImageData,tile.toX,tile.toY,tile.toInnerX-tile.toX,tile.toInnerY-tile.toY,tile.toInnerWidth+1e-5,tile.toInnerHeight+1e-5)}else{stageEnv.toCtx.putImageData(toImageData,tile.toX,tile.toY,tile.toInnerX-tile.toX,tile.toInnerY-tile.toY,tile.toInnerWidth,tile.toInnerHeight)}return null};Pica.prototype.__tileAndResize=function(from,to,opts){var _this3=this;var stageEnv={srcCtx:null,srcImageBitmap:null,isImageBitmapReused:false,toCtx:null};var processTile=function processTile(tile){return _this3.__limit(function(){if(opts.canceled)return opts.cancelToken;var tileOpts={width:tile.width,height:tile.height,toWidth:tile.toWidth,toHeight:tile.toHeight,scaleX:tile.scaleX,scaleY:tile.scaleY,offsetX:tile.offsetX,offsetY:tile.offsetY,quality:opts.quality,alpha:opts.alpha,unsharpAmount:opts.unsharpAmount,unsharpRadius:opts.unsharpRadius,unsharpThreshold:opts.unsharpThreshold};_this3.debug("Invoke resize math");return Promise.resolve(tileOpts).then(function(tileOpts){return _this3.__extractTileData(tile,from,opts,stageEnv,tileOpts)}).then(function(tileOpts){_this3.debug("Invoke resize math");return _this3.__invokeResize(tileOpts,opts)}).then(function(result){if(opts.canceled)return opts.cancelToken;stageEnv.srcImageData=null;return _this3.__landTileData(tile,result,stageEnv)})})};return Promise.resolve().then(function(){stageEnv.toCtx=to.getContext("2d",{alpha:Boolean(opts.alpha)});if(utils.isCanvas(from))return null;if(utils.isImageBitmap(from)){stageEnv.srcImageBitmap=from;stageEnv.isImageBitmapReused=true;return null}if(utils.isImage(from)){if(!CAN_CREATE_IMAGE_BITMAP)return null;_this3.debug("Decode image via createImageBitmap");return createImageBitmap(from).then(function(imageBitmap){stageEnv.srcImageBitmap=imageBitmap})["catch"](function(e){return null})}throw new Error('Pica: ".from" should be Image, Canvas or ImageBitmap')}).then(function(){if(opts.canceled)return opts.cancelToken;_this3.debug("Calculate tiles");var regions=createRegions({width:opts.width,height:opts.height,srcTileSize:_this3.options.tile,toWidth:opts.toWidth,toHeight:opts.toHeight,destTileBorder:opts.__destTileBorder});var jobs=regions.map(function(tile){return processTile(tile)});function cleanup(stageEnv){if(stageEnv.srcImageBitmap){if(!stageEnv.isImageBitmapReused)stageEnv.srcImageBitmap.close();stageEnv.srcImageBitmap=null}}_this3.debug("Process tiles");return Promise.all(jobs).then(function(){_this3.debug("Finished!");cleanup(stageEnv);return to},function(err){cleanup(stageEnv);throw err})})};Pica.prototype.__processStages=function(stages,from,to,opts){var _this4=this;if(opts.canceled)return opts.cancelToken;var _stages$shift=stages.shift(),_stages$shift2=_slicedToArray(_stages$shift,2),toWidth=_stages$shift2[0],toHeight=_stages$shift2[1];var isLastStage=stages.length===0;opts=assign({},opts,{toWidth:toWidth,toHeight:toHeight,quality:isLastStage?opts.quality:Math.min(1,opts.quality)});var tmpCanvas;if(!isLastStage){tmpCanvas=this.options.createCanvas(toWidth,toHeight)}return this.__tileAndResize(from,isLastStage?to:tmpCanvas,opts).then(function(){if(isLastStage)return to;opts.width=toWidth;opts.height=toHeight;return _this4.__processStages(stages,tmpCanvas,to,opts)}).then(function(res){if(tmpCanvas){tmpCanvas.width=tmpCanvas.height=0}return res})};Pica.prototype.__resizeViaCreateImageBitmap=function(from,to,opts){var _this5=this;var toCtx=to.getContext("2d",{alpha:Boolean(opts.alpha)});this.debug("Resize via createImageBitmap()");return createImageBitmap(from,{resizeWidth:opts.toWidth,resizeHeight:opts.toHeight,resizeQuality:utils.cib_quality_name(opts.quality)}).then(function(imageBitmap){if(opts.canceled)return opts.cancelToken;if(!opts.unsharpAmount){toCtx.drawImage(imageBitmap,0,0);imageBitmap.close();toCtx=null;_this5.debug("Finished!");return to}_this5.debug("Unsharp result");var tmpCanvas=_this5.options.createCanvas(opts.toWidth,opts.toHeight);var tmpCtx=tmpCanvas.getContext("2d",{alpha:Boolean(opts.alpha)});tmpCtx.drawImage(imageBitmap,0,0);imageBitmap.close();var iData=tmpCtx.getImageData(0,0,opts.toWidth,opts.toHeight);_this5.__mathlib.unsharp_mask(iData.data,opts.toWidth,opts.toHeight,opts.unsharpAmount,opts.unsharpRadius,opts.unsharpThreshold);toCtx.putImageData(iData,0,0);tmpCanvas.width=tmpCanvas.height=0;iData=tmpCtx=tmpCanvas=toCtx=null;_this5.debug("Finished!");return to})};Pica.prototype.resize=function(from,to,options){var _this6=this;this.debug("Start resize...");var opts=assign({},DEFAULT_RESIZE_OPTS);if(!isNaN(options)){opts=assign(opts,{quality:options})}else if(options){opts=assign(opts,options)}opts.toWidth=to.width;opts.toHeight=to.height;opts.width=from.naturalWidth||from.width;opts.height=from.naturalHeight||from.height;if(to.width===0||to.height===0){return Promise.reject(new Error("Invalid output size: ".concat(to.width,"x").concat(to.height)))}if(opts.unsharpRadius>2)opts.unsharpRadius=2;opts.canceled=false;if(opts.cancelToken){opts.cancelToken=opts.cancelToken.then(function(data){opts.canceled=true;throw data},function(err){opts.canceled=true;throw err})}var DEST_TILE_BORDER=3;opts.__destTileBorder=Math.ceil(Math.max(DEST_TILE_BORDER,2.5*opts.unsharpRadius|0));return this.init().then(function(){if(opts.canceled)return opts.cancelToken;if(_this6.features.cib){return _this6.__resizeViaCreateImageBitmap(from,to,opts)}var stages=createStages(opts.width,opts.height,opts.toWidth,opts.toHeight,_this6.options.tile,opts.__destTileBorder);return _this6.__processStages(stages,from,to,opts)})};Pica.prototype.resizeBuffer=function(options){var _this7=this;var opts=assign({},DEFAULT_RESIZE_OPTS,options);return this.init().then(function(){return _this7.__mathlib.resizeAndUnsharp(opts)})};Pica.prototype.toBlob=function(canvas,mimeType,quality){mimeType=mimeType||"image/png";return new Promise(function(resolve){if(canvas.toBlob){canvas.toBlob(function(blob){return resolve(blob)},mimeType,quality);return}if(canvas.convertToBlob){resolve(canvas.convertToBlob({type:mimeType,quality:quality}));return}var asString=atob(canvas.toDataURL(mimeType,quality).split(",")[1]);var len=asString.length;var asBuffer=new Uint8Array(len);for(var i=0;i<len;i++){asBuffer[i]=asString.charCodeAt(i)}resolve(new Blob([asBuffer],{type:mimeType}))})};Pica.prototype.debug=function(){};module.exports=Pica},{"./lib/mathlib":1,"./lib/pool":13,"./lib/stepper":14,"./lib/tiler":15,"./lib/utils":16,"./lib/worker":17,"object-assign":23,webworkify:24}]},{},[])("/index.js")});var install_prompt;window.addEventListener("beforeinstallprompt",function(event){event.preventDefault();install_prompt=event;if(!getCookie("prompt_dismissed")){m.redraw()}});window.addEventListener("appinstalled",function(event){install_prompt=null});if("serviceWorker"in navigator){navigator.serviceWorker.register("/service.min.js?v=2",{scope:"."}).then(function(registration){},function(err){})}var visibility_change;if(typeof document.hidden!=="undefined"){hidden="hidden";visibility_change="visibilitychange"}else if(typeof document.msHidden!=="undefined"){hidden="msHidden";visibility_change="msvisibilitychange"}else if(typeof document.webkitHidden!=="undefined"){hidden="webkitHidden";visibility_change="webkitvisibilitychange"}function randomNumber(min,max,int){var random=Math.floor(Math.random()*(max-min+1))+min;if(int){return parseInt(random)}return random}function randomBoolean(){return Math.random()<.5}function isCompatibleDesktop(){return(window.innerWidth>window.innerHeight||window.innerHeight>window.innerWidth*.666666666)&&window.innerHeight>=480}function getDeviceOrientation(){if(isCompatibleDesktop()){document.body.classList.add("desktop");return"portrait"}else{document.body.classList.remove("desktop");if(Math.abs(window.innerHeight-window.innerWidth)<window.innerWidth/2){return"undefined"}return window.innerHeight>window.innerWidth?"portrait":"landscape"}}function isIos(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}function isAndroid(){return["Android"].includes(navigator.platform)}function isMobile(){return override||typeof window.orientation!=="undefined"||navigator.userAgent.indexOf("IEMobile")!==-1||"ontouchend"in document}function throttle(func,limit){var waiting=false;return function(){var context=this;var args=arguments;if(!waiting){func.apply(context,args);waiting=true;setTimeout(function(){waiting=false},limit)}}}function debounce(func,wait,immediate){var timeout;return function(){var context=this;var args=arguments;var later=function(){timeout=null;if(!immediate){func.apply(context,args)}};var callNow=immediate&&!timeout;clearTimeout(timeout);timeout=setTimeout(later,wait);if(callNow){func.apply(context,args)}}}function clamp(number,min,max){return Math.min(Math.max(number,min),max)}function die(reason){throw new Error(reason)}function colorDistance(a,b){return Math.sqrt(Math.pow(a[0]-b[0],2)+Math.pow(a[1]-b[1],2)+Math.pow(a[2]-b[2],2))}function approximateColor(arg,list,min){if(list.length==2){if(colorDistance(arg,min)<=colorDistance(arg,list[1])){return min}else{return list[1]}}else{var tl=list.slice(1);if(colorDistance(arg,min)<=colorDistance(arg,list[1])){min=min}else{min=list[1]}return approximateColor(arg,tl,min)}}function separateChannels(image){var imageR=new ImageData(image.width,image.height);var dR=imageR.data;var imageG=new ImageData(image.width,image.height);var dG=imageG.data;var imageB=new ImageData(image.width,image.height);var dB=imageB.data;image.data.forEach(function(v,i){if(i%4===0){dR[i]=v;dR[i+1]=v;dR[i+2]=v;dR[i+3]=255}if(i%4===1){dG[i-1]=v;dG[i]=v;dG[i+1]=v;dG[i+2]=255}if(i%4===2){dB[i-2]=v;dB[i-1]=v;dB[i]=v;dB[i+1]=255}});return{r:imageR,g:imageG,b:imageB}}function mergeChannels(r,g,b){var image=r;var d=image.data;d.forEach(function(v,i){if(i%4===1){d[i]=g.data[i]}if(i%4===2){d[i]=b.data[i]}});return image}function orderedDither(image,palette,gamma,brightness,contrast,noise,rgb){if(rgb){var channels=separateChannels(image);var ditheredR=orderedDither(channels.r,palette,gamma,brightness,contrast,noise);var ditheredG=orderedDither(channels.g,palette,gamma,brightness,contrast,noise);var ditheredB=orderedDither(channels.b,palette,gamma,brightness,contrast,noise);var rgbImage=mergeChannels(ditheredR,ditheredG,ditheredB);return rgbImage}else{var d=image.data;var w=image.width;var h=image.height;var ratio=4;var m=new Array([1,9,3,11],[13,5,15,7],[4,12,2,10],[16,8,14,6]);var fR=.2126;var fG=.7152;var fB=.0722;var r,g,b,i,color,approx,tr,tg,tb,dx,dy,di;for(var y=0;y<h;y++){for(var x=0;x<w;x++){i=4*x+4*y*w;r=i;g=i+1;b=i+2;a=i+3;d[r]=parseInt(clamp((contrast-.2)*(d[r]-128)+128,0,255));d[g]=parseInt(clamp((contrast-.2)*(d[g]-128)+128,0,255));d[b]=parseInt(clamp((contrast-.2)*(d[b]-128)+128,0,255));d[r]=parseInt(clamp(d[r]*(brightness+.2),0,255));d[g]=parseInt(clamp(d[g]*(brightness+.2),0,255));d[b]=parseInt(clamp(d[b]*(brightness+.2),0,255));if(noise!==0){var luminance=fR*d[r]/255+fG*d[g]/255+fB*d[b]/255;var factor=luminance<.5?Math.abs(luminance/.5):Math.abs(luminance/.5-2);var grain=noise*factor;grain=randomNumber(grain*-1,grain);d[r]=parseInt(clamp(d[r]+grain*fR,0,255));d[g]=parseInt(clamp(d[g]+grain*fG,0,255));d[b]=parseInt(clamp(d[b]+grain*fB,0,255))}if(!debug_dither){d[r]+=m[x%4][y%4]*ratio;d[r]=255*Math.pow(d[r]/255,gamma);d[g]+=m[x%4][y%4]*ratio;d[g]=255*Math.pow(d[g]/255,gamma);d[b]+=m[x%4][y%4]*ratio;d[b]=255*Math.pow(d[b]/255,gamma);color=new Array(d[r],d[g],d[b]);approx=approximateColor(color,dithering_palette,dithering_palette[0]);tr=approx[0];tg=approx[1];tb=approx[2];for(dx=0;dx<1;dx++){for(dy=0;dy<1;dy++){di=i+4*dx+4*w*dy;d[di]=tr;d[di+1]=tg;d[di+2]=tb}}}}}return applyPalette(image,palette)}}function applyPalette(image,palette){var d=image.data;var w=image.width;var h=image.height;for(var y=0;y<h;y++){for(var x=0;x<w;x++){i=4*x+4*y*w;r=i;g=i+1;b=i+2;a=i+3;if(d[r]===dithering_palette[0][0]&&d[g]===dithering_palette[0][1]&&d[b]===dithering_palette[0][2]){d[r]=palette[0][0];d[g]=palette[0][1];d[b]=palette[0][2]}else if(d[r]===dithering_palette[1][0]&&d[g]===dithering_palette[1][1]&&d[b]===dithering_palette[1][2]){d[r]=palette[1][0];d[g]=palette[1][1];d[b]=palette[1][2]}else if(d[r]===dithering_palette[2][0]&&d[g]===dithering_palette[2][1]&&d[b]===dithering_palette[2][2]){d[r]=palette[2][0];d[g]=palette[2][1];d[b]=palette[2][2]}else if(d[r]===dithering_palette[3][0]&&d[g]===dithering_palette[3][1]&&d[b]===dithering_palette[3][2]){d[r]=palette[3][0];d[g]=palette[3][1];d[b]=palette[3][2]}else{console.log("color not found")}}}return image}function resize(source_context,target_context,scale_context,post_process,callback,quality,amount,radius,threshold,direction){if(quality===undefined){quality=-1}if(callback){var scale_width;var scale_height;var source_width=source_context.canvas.width;var source_height=source_context.canvas.height;var target_width=target_context.canvas.width;var target_height=target_context.canvas.height;if(source_height<=source_width){scale_width=target_height/source_height*source_width;scale_height=target_height;offset_x=Math.floor((scale_width-target_width)/2);offset_y=0}else{scale_width=target_width;scale_height=target_width/source_width*source_height;offset_x=0;offset_y=Math.floor((scale_height-target_height)/2)}scale_context.canvas.width=scale_width;scale_context.canvas.height=scale_height;if(direction==="user"){scale_context.translate(scale_width,0);scale_context.scale(-1,1)}if(quality>-1){amount=amount||160;radius=radius||.6;threshold=threshold||1;pica.resize(source_context.canvas,scale_context.canvas,{unsharpAmount:amount,unsharpRadius:radius,unsharpThreshold:threshold,quality:quality}).then(function(result){var image_data=scale_context.getImageData(offset_x,offset_y,target_width,target_height);target_context.putImageData(post_process(image_data),0,0);callback()})}else{scale_context.drawImage(source_context.canvas,0,0,scale_width,scale_height);var image_data=scale_context.getImageData(offset_x,offset_y,target_width,target_height);target_context.putImageData(post_process(image_data),0,0);callback()}}}function getTimestamp(){return"pocket_camera_"+Math.floor(Date.now()/1e3)}function route(requestedPath){window.location.replace(m.route.prefix+requestedPath)}function getCookie(key){var t="; "+document.cookie,i=t.split("; "+key+"=");var result;try{result=JSON.parse(2!=i.length?void 0:i.pop().split(";").shift())}catch(e){result=false}return result}function setCookie(key,value,days){var s=new Date;s.setDate(s.getDate()+(days||365));var r=[key+"="+(JSON.stringify(value)||""),"expires="+s.toUTCString(),"path=/","SameSite=strict","Secure"];document.cookie=r.join(";");return getCookie(key)}document.addEventListener("contextmenu",function(event){event.preventDefault();return false});function stopStream(){if(typeof stream!=="undefined"&&stream!=="initializing"){stream.getTracks().forEach(function(track){track.stop();stream=undefined})}}function adjustBrightness(context){if(isIos()){if(brightness_modifier<100){context.globalCompositeOperation="multiply";context.globalAlpha=brightness_modifier/100;context.fillStyle="black";context.fillRect(0,0,camera_width,camera_height)}if(brightness_modifier>100){context.globalCompositeOperation="screen";context.globalAlpha=brightness_modifier/100;context.fillStyle="white";context.fillRect(0,0,camera_width,camera_height)}context.globalCompositeOperation="source-over"}}function getComposite(callback,palette,blob){composite_context.restore();var composite_width=camera_width;var composite_height=camera_height;if(!frame_disabled){composite_width=camera_width+32;composite_height=camera_height+32}composite_canvas.width=composite_width;composite_canvas.height=composite_height;var frame=new Image;frame.onload=function(){if(!frame_disabled){composite_context.drawImage(frame,0,0);composite_context.putImageData(applyPalette(composite_context.getImageData(0,0,composite_width,composite_height),palette),0,0)}if(facing_mode==="user"){composite_context.translate(composite_width,0);composite_context.scale(-1,1)}if(!frame_disabled){composite_context.drawImage(preview_canvas,16,16)}else{composite_context.drawImage(preview_canvas,0,0)}var image=new Image;image.onload=function(){composite_canvas.width=composite_width*composite_scale;composite_canvas.height=composite_height*composite_scale;composite_context.mozImageSmoothingEnabled=false;composite_context.oImageSmoothingEnabled=false;composite_context.webkitImageSmoothingEnabled=false;composite_context.msImageSmoothingEnabled=false;composite_context.imageSmoothingEnabled=false;composite_context.drawImage(image,0,0,composite_canvas.width,composite_canvas.height);if(callback){if(blob){composite_canvas.toBlob(callback,"image/jpeg",0)}else{callback(composite_canvas.toDataURL("image/jpeg",0))}}};image.src=composite_canvas.toDataURL()};frame.src=frames[0]}var optimized="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAACQAgMAAADy24gTAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAMUExURf///wAAALi4uGhoaF7tJKgAAAGfSURBVFjD7dg9SgNBFAfwtzhjdoxrUjjaiGzhJCAqNmvtprPbYnczRYphvcDiCcykMhDYIgkewAN4hKAXSBNImcLWM+jG4Ee+FaIgvFf/4PF/vOoPwTcHfhV6P4A+XxUsMSlUEqmEBlpVoSYFqGqgid20W2PwXEc39eSmceSEh9ow7cuLDW2EJjEPTDEG3SvXpR4FsnPHGy7Jnxu04YYO2T3YnQUt6m+TN+gGc+Bo9WOd8OFqko+qVBvrM1aPwsSqyYdhSF4KqlI7HcadfROff9zrp3DVTwFLBiFChAgRIkSIECFChAgRIkSIEOH/gr/YP0q+FJZh2I/JUUmmjufDEMQnBLYAFuiwgUyhL8Ls8yKY0b1Oct9ei1lFBA+sfsKUo/feG7svcBOK0O1IOz6WvAwMwND0+hQmoQ/2DhGx4XX7XPKwyBirWhaL4mmYtFPIYrhtVRxfpKgGzCp5vQlYcbwmEUrHL/2Wn30q5nJWNvdileJpWIEziFT3WrbKUICtDGVmxlIwCdMAuqcjb5+lJxo4ej2FgzaV9t90zQvnFSRFuqTL26wiAAAAAElFTkSuQmCC";var frames=[optimized];var dithering_palette=[[0,0,0],[104,104,104],[184,184,184],[255,255,255]];var palettes=[[[0,0,0],[85,85,85],[170,170,170],[255,255,255]],[[44,87,70],[68,126,94],[107,179,113],[138,206,113]]];pica=window.pica({});var root=document.body;var times=[];var true_fps=0;var target_fps=12;var last_tick=0;var hidden;var screen_height;var screen_width;var controls_height;var controls_width;var padding=40;var camera_width=128;var camera_height=112;var override=getCookie("override")||false;var frame_disabled=getCookie("frame_disabled")||false;var device_orientation=getDeviceOrientation();var not_supported=false;var standby=false;var background=false;var stream;var facing_modes=["environment","user"];var facing_mode=facing_modes[0];var debug_color=false;var debug_dither=false;var animation;var constraints={};var video_element;var video_height=1080;var video_width=1920;var video_wrapper;var video_canvas;var video_context;var camera_wrapper;var camera_canvas;var camera_context;var preview_active=false;var preview_wrapper;var preview_canvas;var preview_context;var scale_wrapper;var scale_canvas;var scale_context;var scale_quality=0;var sharpen_amount=200;var sharpen_radius=.6;var sharpen_threshold=15;var composite_wrapper;var composite_canvas;var composite_context;var composite_scale=8;var gamma_modifier=2;var contrast_modifier=1;var brightness_modifier=1;var noise_modifier=64;var rgb_enabled=false;var active_palette=palettes[0];var routes={"/":{view:CameraPage,title:"Pocket Camera"}};function Install(){return{view:function(){return m("div",{class:"install"+(install_prompt&&!getCookie("prompt_dismissed")?" install--active":"")},m("img",{src:"/favicon.svg"}),m("button",{class:"button call-prompt",onclick:function(event){install_prompt.prompt()}},"Install App"),m("button",{class:"dismiss-prompt",onclick:function(event){setCookie("prompt_dismissed",true,1)}}))}}}function View(){if(m.route.get()==="/"){window.location.replace("")}return{view:function(vnode){return m("main",{class:"view view"+(m.route.get()||"-camera").replace(/\//gm,"-").toLowerCase()},m(routes[m.route.get()||"/"].view))}}}function Scaffold(){return{view:function(vnode){return m("div",{class:"scaffold"},[m(Install),m(View)])}}}function CameraPage(){function render(){setTimeout(function(){if(standby||not_supported){animation=window.requestAnimationFrame(function(){destroyCamera();render()})}else{if(!preview_active&&!standby&&!not_supported){if(typeof stream!=="undefined"&&stream!=="initializing"){video_width=stream.getTracks()[0].getSettings().width;video_height=stream.getTracks()[0].getSettings().height;video_canvas.width=video_width;video_canvas.height=video_height;video_context.drawImage(video_element,0,0,video_width,video_height);resize(video_context,camera_context,scale_context,function(image_data){if(debug_color){return image_data}else{return orderedDither(image_data,active_palette,gamma_modifier,brightness_modifier,contrast_modifier,noise_modifier,rgb_enabled)}},function(){animation=window.requestAnimationFrame(function(){render()})},scale_quality,sharpen_amount,sharpen_radius,sharpen_threshold,facing_mode)}else if(typeof stream==="undefined"){initializeCamera()}}else{animation=window.requestAnimationFrame(function(){destroyCamera();render()})}}},1e3/target_fps)}function destroyCamera(){stopStream();if(typeof animation!=="undefined"){window.cancelAnimationFrame(animation)}}function initializeCamera(){constraints.facingMode=facing_mode;destroyCamera();stream="initializing";if(navigator.mediaDevices.getUserMedia){navigator.mediaDevices.getUserMedia({video:constraints,audio:false}).then(function(currentStream){stream=currentStream;video_element.srcObject=stream;render()}).catch(function(error){alert("Camera error! Please allow access to the camera.")})}else{alert("Camera error! Please allow access to the camera.")}}return{view:function(){return not_supported?m("div",{class:"error-page"},m("div",{class:"error-message"},[m("div",{class:"error-icon mdi mdi-cellphone-erase"}),m("div",{class:"error-text"},"Not supported.")])):m("div",{class:"camera-page"+(preview_active?" preview":"")+(rgb_enabled?" rgb":"")},[m("div",{class:"screen-wrapper",style:"position: absolute; top: "+padding+"px; left: "+padding+"px; height:"+screen_height+"px;width:"+screen_width+"px;"},[m("video",{playsinline:true,autoplay:true,oncreate:function(vnode){video_element=vnode.dom}}),m("svg",{width:0,height:0,style:"display: none;"},m("filter",{id:"sharpen"},m("feConvolveMatrix",{kernelMatrix:"0 -1 0 -1 15 -1 0 -1 0"}))),m("div",{class:"canvas-wrapper camera-wrapper",oncreate:function(vnode){camera_wrapper=vnode.dom}},m("canvas",{oncreate:function(vnode){camera_canvas=vnode.dom;camera_context=camera_canvas.getContext("2d");camera_canvas.width=camera_width;camera_canvas.height=camera_height;camera_context.fillStyle="black";camera_context.fillRect(0,0,camera_width,camera_height);initializeCamera()},onremove:function(vnode){destroyCamera()}})),m("div",{class:"canvas-wrapper preview-wrapper"+(frame_disabled?" frame-disabled":""),oncreate:function(vnode){preview_wrapper=vnode.dom}},[m("div",{class:"preview-buttons"},[m("button",{class:"frame-button mdi"+(frame_disabled?" mdi-checkbox-blank-outline":" mdi-checkbox-marked-outline"),onclick:function(){frame_disabled=!frame_disabled;setCookie("frame_disabled",frame_disabled)}},""),m("button",{class:"save-button mdi mdi-content-save",onclick:function(){getComposite(function(composited_image){preview_active=false;var link=document.createElement("a");link.download=getTimestamp()+".jpg";link.href=composited_image;link.click();m.redraw()},active_palette)}},""),m("button",{class:"share-button mdi mdi-share-variant",onclick:function(){getComposite(function(composited_image){var file=new File([composited_image],getTimestamp()+".jpg",{type:"image/jpeg"});var files_array=[file];if(navigator.canShare&&navigator.canShare({files:files_array})){navigator.share({files:files_array}).then(function(){}).catch(function(error){console.log(error)})}else{alert("Your device does not support sharing files. You can save the image to your device instead.")}m.redraw()},active_palette,true)}},""),m("button",{class:"delete-button mdi mdi-delete",onclick:function(){preview_active=false}},"")]),m("canvas",{oncreate:function(vnode){preview_canvas=vnode.dom;preview_context=preview_canvas.getContext("2d");preview_canvas.width=camera_width;preview_canvas.height=camera_height}})]),m("div",{class:"canvas-wrapper composite-wrapper",oncreate:function(vnode){composite_wrapper=vnode.dom}},m("canvas",{oncreate:function(vnode){composite_canvas=vnode.dom;composite_context=composite_canvas.getContext("2d")}})),m("div",{class:"canvas-wrapper scale-wrapper",oncreate:function(vnode){scale_wrapper=vnode.dom}},m("canvas",{oncreate:function(vnode){scale_canvas=vnode.dom;scale_context=scale_canvas.getContext("2d")}})),m("div",{class:"canvas-wrapper video-wrapper",oncreate:function(vnode){video_wrapper=vnode.dom}},m("canvas",{oncreate:function(vnode){video_canvas=vnode.dom;video_context=video_canvas.getContext("2d")}}))]),m("div",{class:"controls-wrapper",style:"position: absolute; bottom: "+padding+"px; left: "+padding+"px; height:"+controls_height+"px;width:"+controls_width+"px;"},[m("div",{class:"logo",onclick:function(){rgb_enabled=!rgb_enabled}}),m("div",{class:"d-pad-wrapper"},[m("button",{"aria-label":"Increase Brightness",class:"up-button mdi mdi-triangle",onclick:function(){brightness_modifier=clamp(brightness_modifier+.1,.5,1.5)}},""),m("button",{"aria-label":"Increase Contrast",class:"right-button mdi mdi-triangle",onclick:function(){contrast_modifier=clamp(contrast_modifier+.1,.5,1.5)}},""),m("button",{"aria-label":"Decrease Brightness",class:"down-button mdi mdi-triangle",onclick:function(){brightness_modifier=clamp(brightness_modifier-.1,.5,1.5)}},""),m("button",{"aria-label":"Decrease Contrast",class:"left-button mdi mdi-triangle",onclick:function(){contrast_modifier=clamp(contrast_modifier-.1,.5,1.5)}},""),m("div",{class:"d-pad"},[m("div",{class:"d-pad-shadow"},""),m("div",{class:"d-pad-3d"},""),m("div",{class:"d-pad-center"},m("div",{class:"d-pad-indent",onclick:function(){if(palettes.indexOf(active_palette)===0){active_palette=palettes[1]}else{active_palette=palettes[0]}}},""))])]),m("div",{class:"a-and-b-wrapper"},[m("button",{"aria-label":"Take Picture",class:"a-button mdi mdi-camera-iris",onclick:function(){preview_context.drawImage(camera_canvas,0,0);preview_active=true}},""),m("button",{"aria-label":"Switch Camera",class:"b-button mdi mdi-camera-switch",onclick:function(){facing_mode=facing_modes[facing_modes.indexOf(facing_mode)===0?1:0];initializeCamera()}},"")]),m("div",{class:"meta-wrapper"},m("a",{href:"https://trashbytes.cc/blog/pocket-camera-a-pwa-which-let-s-you-take-pictures-inspired-by-the-game-boy-camera",target:"_blank"},"about"))]),m("div",{class:"fps-counter"},true_fps)])}}}m.route(root,Object.keys(routes)[0],function(){var mroutes={};Object.keys(routes).map(function(route){mroutes[route]={onmatch:function(args,requestedPath,route){return Scaffold}}});return mroutes}());function lifecycle(){if((isMobile()||isCompatibleDesktop())&&window.innerWidth>=320){not_supported=false;if(document[hidden]){standby=true;stopStream()}else{if(device_orientation==="portrait"){not_supported=false;padding=parseInt(document.body.clientWidth*.1);if(padding>60){padding=60}root.style.setProperty("--padding",padding+"px");screen_width=document.body.clientWidth-padding*2;screen_height=screen_width*camera_height/camera_width;controls_width=screen_width;controls_height=document.body.clientHeight-screen_height-padding*3;standby=false}else{not_supported=true;stopStream()}}}else{not_supported=true;stopStream()}m.redraw()}var debouncedLifecycle=debounce(lifecycle,100);window.addEventListener("resize",function(event){var new_device_orientation=getDeviceOrientation();if(new_device_orientation!==device_orientation){device_orientation=new_device_orientation;lifecycle()}else{device_orientation=new_device_orientation;debouncedLifecycle()}});document.addEventListener(visibility_change,function(event){debouncedLifecycle()});lifecycle();